
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Studio - Secure Knowledge Base & Chat Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            border-color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group label i {
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Advanced Custom Dropdown */
        .custom-select {
            position: relative;
            width: 100%;
        }

        .select-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
            color: var(--dark);
        }

        .select-header:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .select-header.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .select-header i {
            transition: var(--transition);
            color: var(--gray);
        }

        .select-header.active i {
            transform: rotate(180deg);
            color: var(--primary);
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 16px;
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            box-shadow: var(--shadow-xl);
        }

        .select-options.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .select-option {
            padding: 14px 18px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }

        .select-option:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .select-option.selected {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary);
            font-weight: 600;
        }

        .select-option i {
            font-size: 1.2rem;
            min-width: 24px;
            text-align: center;
        }

        /* Searchable dropdown */
        .select-search {
            padding: 12px 18px;
            border-bottom: 1px solid var(--border);
            background: rgba(249, 250, 251, 0.8);
        }

        .select-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.9rem;
            outline: none;
        }

        .select-search input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
        }

        .input-group {
            position: relative;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 16px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .provider-select, .file-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 16px;
            margin-bottom: 22px;
        }

        .provider-option, .file-type-option {
            text-align: center;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
            background: white;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .provider-option:hover, .file-type-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .provider-option.selected, .file-type-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .provider-option i, .file-type-option i {
            font-size: 2rem;
            color: var(--primary);
            transition: var(--transition);
        }

        .provider-option.selected i, .file-type-option.selected i {
            color: var(--primary);
            transform: scale(1.1);
        }

        .keys-list, .kb-list {
            max-height: 350px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .keys-list::-webkit-scrollbar, .kb-list::-webkit-scrollbar {
            width: 6px;
        }

        .keys-list::-webkit-scrollbar-track, .kb-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .keys-list::-webkit-scrollbar-thumb, .kb-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .key-item, .kb-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .key-item:hover, .kb-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .key-info, .kb-info {
            flex: 1;
        }

        .key-info h4, .kb-info h4 {
            font-size: 1.15rem;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 700;
        }

        .key-info p, .kb-info p {
            font-size: 0.95rem;
            color: var(--gray);
            line-height: 1.5;
        }

        .key-actions, .kb-actions {
            display: flex;
            gap: 12px;
            min-width: 180px;
            justify-content: flex-end;
        }

        .key-actions button, .kb-actions button {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn, .favorite-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .copy-btn:hover, .favorite-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .favorite-btn.favorited {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 28px;
            border-radius: 16px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(120%);
            transition: var(--transition);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }

        .security-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            text-align: center;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .feature-card i {
            font-size: 2.5rem;
            margin-bottom: 18px;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .feature-card h3 {
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 700;
        }

        .feature-card p {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--border);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
        }

        .empty-state p {
            font-size: 1.1rem;
            color: var(--gray);
            line-height: 1.6;
        }

        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn.loading {
            position: relative;
            padding-right: 45px;
        }

        .btn.loading .loading {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Knowledge Base Specific Styles */
        .kb-filters {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 180px;
        }

        .file-upload-area {
            border: 3px dashed var(--border);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 25px;
            transition: var(--transition);
            cursor: pointer;
            background: rgba(249, 250, 251, 0.5);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.02);
        }

        .file-upload-area i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .file-upload-area:hover i {
            transform: scale(1.1) rotate(5deg);
        }

        .file-upload-area p {
            color: var(--gray);
            font-size: 1.1rem;
            margin: 8px 0;
            font-weight: 500;
        }

        .file-list {
            max-height: 220px;
            overflow-y: auto;
            margin-top: 20px;
            padding-right: 8px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 12px;
            transition: var(--transition);
        }

        .file-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .file-item .file-name {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item .file-name i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .file-item .file-size {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 500;
        }

        .remove-file {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
            font-weight: 600;
        }

        .remove-file:hover {
            transform: scale(1.05);
        }

        /* Chat Interface */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 520px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .message {
            margin-bottom: 20px;
            padding: 16px 20px;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .message.user {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 6px;
        }

        .message.assistant {
            background: white;
            color: var(--dark);
            border: 1px solid var(--border);
            border-bottom-left-radius: 6px;
            box-shadow: var(--shadow);
        }

        .chat-input {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid var(--border);
            gap: 12px;
        }

        .chat-input input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: 18px;
            font-size: 1.05rem;
            margin-right: 0;
            font-family: inherit;
        }

        .chat-input button {
            padding: 16px 28px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.05rem;
        }

        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .kb-selector {
            margin-bottom: 25px;
        }

        /* Knowledge Base Detail Page */
        .kb-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .kb-detail-info {
            flex: 1;
            min-width: 300px;
        }

        .kb-detail-info h2 {
            font-size: 1.8rem;
            margin-bottom: 12px;
        }

        .kb-detail-info p {
            color: var(--gray);
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .kb-detail-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .kb-detail-actions button {
            padding: 12px 24px;
            border-radius: 16px;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            min-width: 120px;
            justify-content: center;
        }

        .kb-content {
            margin-top: 25px;
        }

        .kb-section {
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .kb-section h3 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .kb-files-grid, .kb-urls-list {
            display: grid;
            gap: 20px;
        }

        .kb-file-card, .kb-url-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .kb-file-card:hover, .kb-url-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .kb-file-card h4, .kb-url-card h4 {
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .kb-file-card p, .kb-url-card p {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Back button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 14px 28px;
            border-radius: 18px;
            text-decoration: none;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.05rem;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .kb-detail-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .kb-detail-actions {
                justify-content: center;
            }
            
            .chat-container {
                height: 450px;
            }
            
            .provider-select, .file-types {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .kb-actions {
                flex-direction: column;
                min-width: auto;
                gap: 8px;
            }
            
            .key-actions button, .kb-actions button {
                width: 100%;
                justify-content: center;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                min-width: 120px;
            }
        }
		
		
		
		
		.kb-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin: 25px 0;
}

.stat-card {
    background: white;
    border-radius: 20px;
    padding: 24px;
    box-shadow: var(--shadow-xl);
    display: flex;
    align-items: center;
    gap: 16px;
    transition: var(--transition);
    border: 1px solid var(--border);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 18px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-icon i {
    font-size: 1.8rem;
    color: var(--primary);
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-content {
    flex: 1;
}

.stat-number {
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--dark);
    line-height: 1.2;
}

.stat-label {
    font-size: 0.95rem;
    color: var(--gray);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}





.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 20px;
    max-width: 500px;
    text-align: center;
    box-shadow: var(--shadow-xl);
}

.modal-content h3 {
    margin-bottom: 20px;
    color: var(--dark);
    font-size: 1.4rem;
}

.modal-content p {
    color: var(--gray);
    margin-bottom: 30px;
    line-height: 1.6;
}

.modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

    </style>
</head>
<body>
    <div class="container">
        <!-- Main Dashboard -->
        <div id="main-dashboard">
            <header>
                <h1><i class="fas fa-brain"></i> AI Studio - Secure Knowledge Base & Chat Playground</h1>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="keys">API Keys Vault</button>
                    <button class="tab-btn" data-tab="knowledge">Knowledge Base</button>
                    <button class="tab-btn" data-tab="chat">Chat Playground</button>
                </div>
            </header>

            <!-- API Keys Vault Tab -->
            <div class="tab-content active" id="keys-tab">
                <div class="main-content">
                    <div class="card">
                        <h2><i class="fas fa-plus-circle"></i> Add New API Key</h2>
                        <form id="apiKeyForm">
                            <div class="form-group">
                                <label for="userId"><i class="fas fa-user"></i> User ID</label>
                                <div class="input-group">
                                    <input type="text" id="userId" placeholder="Enter your user ID" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-robot"></i> Select AI Provider</label>
                                <div class="provider-select" id="providerSelect">
                                    <div class="provider-option" data-provider="openai">
                                        <i class="fab fa-openai"></i>
                                        <span>OpenAI</span>
                                    </div>
                                    <div class="provider-option" data-provider="anthropic">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude</span>
                                    </div>
                                    <div class="provider-option" data-provider="gemini">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini</span>
                                    </div>
                                    <div class="provider-option" data-provider="mistral">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral</span>
                                    </div>
                                    <div class="provider-option" data-provider="cohere">
                                        <i class="fas fa-cube"></i>
                                        <span>Cohere</span>
                                    </div>
                                    <div class="provider-option" data-provider="huggingface">
                                        <i class="fas fa-hat-wizard"></i>
                                        <span>Hugging Face</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="apiKey"><i class="fas fa-key"></i> API Key</label>
                                <div class="input-group">
                                    <input type="password" id="apiKey" placeholder="Enter your API key" required>
                                    <button type="button" class="toggle-password" id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i class="fas fa-save"></i> Store Securely
                            </button>
                        </form>
                    </div>

                    <div class="card">
                        <h2><i class="fas fa-key"></i> Your API Keys</h2>
                        <div class="keys-list" id="keysList">
                            <div class="empty-state">
                                <i class="fas fa-lock"></i>
                                <h3>No API Keys Found</h3>
                                <p>Add your first API key to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="security-features">
                    <div class="feature-card">
                        <i class="fas fa-lock"></i>
                        <h3>End-to-End Encryption</h3>
                        <p>All API keys are encrypted using AES-256-GCM before storage</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Zero Plaintext Storage</h3>
                        <p>Keys are never stored in plaintext anywhere in the system</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-user-shield"></i>
                        <h3>User Isolation</h3>
                        <p>Each user's keys are completely isolated from others</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-sync-alt"></i>
                        <h3>Key Rotation</h3>
                        <p>Easily rotate and update keys without service interruption</p>
                    </div>
                </div>
            </div>

            <!-- Knowledge Base Tab -->
            <div class="tab-content" id="knowledge-tab">
                <div class="card">
                    <h2><i class="fas fa-folder-plus"></i> Create New Knowledge Base</h2>
                    <form id="kbForm">
                        <div class="form-group">
                            <label for="kbName"><i class="fas fa-tag"></i> Knowledge Base Name</label>
                            <div class="input-group">
                                <input type="text" id="kbName" placeholder="Enter knowledge base name" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-file-alt"></i> Supported File Types</label>
                            <div class="file-types" id="fileTypes">
                                <div class="file-type-option" data-type="pdf">
                                    <i class="fas fa-file-pdf"></i>
                                    <span>PDF</span>
                                </div>
                                <div class="file-type-option" data-type="doc">
                                    <i class="fas fa-file-word"></i>
                                    <span>DOC</span>
                                </div>
                                <div class="file-type-option" data-type="txt">
                                    <i class="fas fa-file-alt"></i>
                                    <span>TXT</span>
                                </div>
                                <div class="file-type-option" data-type="csv">
                                    <i class="fas fa-file-csv"></i>
                                    <span>CSV</span>
                                </div>
                                <div class="file-type-option" data-type="url">
                                    <i class="fas fa-link"></i>
                                    <span>URLs</span>
                                </div>
                                <div class="file-type-option" data-type="sitemap">
                                    <i class="fas fa-sitemap"></i>
                                    <span>Sitemap</span>
                                </div>
                                <div class="file-type-option" data-type="robots">
                                    <i class="fas fa-robot"></i>
                                    <span>Robots.txt</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-cloud-upload-alt"></i> Upload Files or Add URLs</label>
                            <div class="file-upload-area" id="fileUploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><strong>Drag & drop files here</strong></p>
                                <p>or click to browse your files</p>
                                <p>Supports PDF, DOC, TXT, CSV, URLs, Sitemaps, Robots.txt</p>
                                <input type="file" id="fileInput" multiple style="display: none;">
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>

                        <div class="form-group">
                            <label for="kbUrls"><i class="fas fa-globe"></i> Additional URLs (one per line)</label>
                            <div class="input-group">
                                <textarea id="kbUrls" rows="4" placeholder="https://example.com/page1&#10;https://example.com/page2"></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="kbSubmitBtn">
                            <i class="fas fa-plus"></i> Create Knowledge Base
                        </button>
                    </form>
                </div>

              
				<div class="kb-stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-folder"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number" id="totalKbs">4</div>
            <div class="stat-label">Total Knowledge Bases</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-file"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number" id="totalFiles">0</div>
            <div class="stat-label">Total Files</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-link"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number" id="totalUrls">0</div>
            <div class="stat-label">Total URLs</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-star"></i>
        </div>
        <div class="stat-content">
            <div class="stat-number" id="favoritedKbs">1</div>
            <div class="stat-label">Favorited</div>
        </div>
    </div>
</div>

              <div class="kb-filters">
    <div class="filter-group">
        <label for="sortKb"><i class="fas fa-sort"></i> Sort By</label>
        <div class="custom-select" id="sortSelect">
            <div class="select-header">
                <span>Date Created</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="select-options">
                <div class="select-option" data-value="date">
                    <i class="fas fa-calendar"></i>
                    <span>Date Created (Latest First)</span>
                </div>
                <div class="select-option" data-value="updated">
                    <i class="fas fa-sync-alt"></i>
                    <span>Last Updated</span>
                </div>
                <div class="select-option selected" data-value="name">
                    <i class="fas fa-font"></i>
                    <span>Name (A-Z)</span>
                </div>
                <div class="select-option" data-value="files">
                    <i class="fas fa-file"></i>
                    <span>File Count</span>
                </div>
            </div>
        </div>
        <!-- Hidden select for programmatic access -->
        <select id="sortKb" style="display:none;">
            <option value="date">Date Created</option>
            <option value="updated">Last Updated</option>
            <option value="name">Name</option>
            <option value="files">File Count</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="filterKb"><i class="fas fa-filter"></i> Filter</label>
        <div class="custom-select" id="filterSelect">
            <div class="select-header">
                <span>All</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="select-options">
                <div class="select-option selected" data-value="all">
                    <i class="fas fa-list"></i>
                    <span>All</span>
                </div>
                <div class="select-option" data-value="favorited">
                    <i class="fas fa-star"></i>
                    <span>Favorited Only</span>
                </div>
                <div class="select-option" data-value="recent">
                    <i class="fas fa-clock"></i>
                    <span>Recent (7 days)</span>
                </div>
            </div>
        </div>
        <!-- Hidden select for programmatic access -->
        <select id="filterKb" style="display:none;">
            <option value="all">All</option>
            <option value="favorited">Favorited Only</option>
            <option value="recent">Recent (7 days)</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="searchKb"><i class="fas fa-search"></i> Search</label>
        <div class="input-group">
            <input type="text" id="searchKb" placeholder="Search knowledge bases...">
        </div>
    </div>
</div>

                <div class="card">
                    <h2><i class="fas fa-folder"></i> Your Knowledge Bases</h2>
                    <div class="kb-list" id="kbList">
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <h3>No Knowledge Bases Found</h3>
                            <p>Create your first knowledge base to get started</p>
                        </div>
                    </div>
                </div>
            </div>
			
			
			
			<div class="kb-detail-actions">
    <button class="btn btn-primary" id="kbDetailEdit">
        <i class="fas fa-edit"></i> Edit
    </button>
    <button class="btn btn-secondary" id="kbDetailFavorite">
        <i class="fas fa-star"></i> Favorite
    </button>
    <button class="btn btn-danger" id="kbDetailDelete">
        <i class="fas fa-trash"></i> Delete
    </button>
</div>





<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3><i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> Confirm Deletion</h3>
        <p>Are you sure you want to delete this knowledge base? This action cannot be undone.</p>
        <div class="modal-buttons">
            <button class="btn btn-secondary" id="cancelDelete">No</button>
            <button class="btn btn-danger" id="confirmDelete">Yes, Delete</button>
        </div>
    </div>
</div>

<!-- Select All Confirmation Modal -->
<div id="selectAllModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h3><i class="fas fa-check-square"></i> Select All Knowledge Bases</h3>
        <p>Are you sure you want to select all knowledge bases? This will affect bulk actions.</p>
        <div class="modal-buttons">
            <button class="btn btn-secondary" id="cancelSelectAll">No</button>
            <button class="btn btn-primary" id="confirmSelectAll">Yes, Select All</button>
        </div>
    </div>
</div>



<div class="kb-bulk-actions" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
    <label class="toggle-container" style="margin: 0;">
        <span>Select All</span>
        <label class="toggle-switch">
            <input type="checkbox" id="selectAllCheckbox">
            <span class="slider"></span>
        </label>
    </label>
    <button class="btn btn-danger" id="bulkDeleteBtn" style="width: auto; padding: 10px 20px;">
        <i class="fas fa-trash"></i> Delete Selected
    </button>
</div>
			
			
			

            <!-- Chat Playground Tab -->
            <div class="tab-content" id="chat-tab">
                <div class="main-content">
                    <div class="card">
                        <h2><i class="fas fa-comments"></i> AI Chat Playground</h2>
                        <div class="kb-selector">
                            <label for="chatKb"><i class="fas fa-folder"></i> Select Knowledge Base</label>
                            <div class="custom-select" id="chatKbSelect">
                                <div class="select-header">
                                    <span>None (General Chat)</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="">
                                        <i class="fas fa-comments"></i>
                                        <span>None (General Chat)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="message assistant">
                                    Hello! I'm your AI assistant. How can I help you today?
                                </div>
                            </div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off">
                                <button id="sendBtn"><i class="fas fa-paper-plane"></i> Send</button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2><i class="fas fa-cogs"></i> Configuration</h2>
                        <div class="form-group">
                            <label for="chatProvider"><i class="fas fa-robot"></i> AI Provider</label>
                            <div class="custom-select" id="chatProviderSelect">
                                <div class="select-header">
                                    <span>OpenAI</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="openai">
                                        <i class="fab fa-openai"></i>
                                        <span>OpenAI</span>
                                    </div>
                                    <div class="select-option" data-value="anthropic">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude (Anthropic)</span>
                                    </div>
                                    <div class="select-option" data-value="gemini">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini (Google)</span>
                                    </div>
                                    <div class="select-option" data-value="mistral">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral AI</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="chatModel"><i class="fas fa-microchip"></i> Model</label>
                            <div class="custom-select" id="chatModelSelect">
                                <div class="select-header">
                                    <span>GPT-4</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="gpt-4">
                                        <i class="fas fa-brain"></i>
                                        <span>GPT-4</span>
                                    </div>
                                    <div class="select-option" data-value="gpt-3.5-turbo">
                                        <i class="fas fa-brain"></i>
                                        <span>GPT-3.5 Turbo</span>
                                    </div>
                                    <div class="select-option" data-value="claude-3-opus">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude 3 Opus</span>
                                    </div>
                                    <div class="select-option" data-value="gemini-pro">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini Pro</span>
                                    </div>
                                    <div class="select-option" data-value="mistral-7b">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral 7B</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="temperature"><i class="fas fa-thermometer-half"></i> Temperature: <span id="tempValue">0.7</span></label>
                            <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" class="input-group">
                        </div>
                        <div class="form-group">
                            <label for="maxTokens"><i class="fas fa-text-height"></i> Max Tokens</label>
                            <div class="input-group">
                                <input type="number" id="maxTokens" min="100" max="4000" value="2000">
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="clearChatBtn">
                            <i class="fas fa-trash"></i> Clear Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Knowledge Base Detail Page -->
        <div id="kb-detail-page" class="tab-content" style="display: none;">
            <a href="#" class="back-btn" id="backToKbList">
                <i class="fas fa-arrow-left"></i> Back to Knowledge Bases
            </a>
            <div class="card">
                <div class="kb-detail-header">
                    <div class="kb-detail-info">
                        <h2 id="kbDetailName"><i class="fas fa-folder"></i> Knowledge Base Name</h2>
                        <p id="kbDetailInfo">Created on <span id="kbDetailDate"></span> • <span id="kbDetailStats"></span></p>
                    </div>
                    <div class="kb-detail-actions">
                        <button class="btn btn-secondary" id="kbDetailFavorite">
                            <i class="fas fa-star"></i> Favorite
                        </button>
                        <button class="btn btn-danger" id="kbDetailDelete">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <div class="kb-content">
                    <div class="kb-section">
                        <h3><i class="fas fa-file"></i> Uploaded Files</h3>
                        <div class="kb-files-grid" id="kbDetailFiles">
                            <div class="empty-state">
                                <i class="fas fa-file-alt"></i>
                                <p>No files uploaded</p>
                            </div>
                        </div>
                    </div>

                    <div class="kb-section">
                        <h3><i class="fas fa-link"></i> URLs & Web Content</h3>
                        <div class="kb-urls-list" id="kbDetailUrls">
                            <div class="empty-state">
                                <i class="fas fa-link"></i>
                                <p>No URLs added</p>
                            </div>
                        </div>
                    </div>

                    <div class="kb-section">
                        <h3><i class="fas fa-info-circle"></i> Knowledge Base Details</h3>
                        <div class="kb-info-grid">
                            <div class="kb-file-card">
                                <h4><i class="fas fa-shield-alt"></i> Security Level</h4>
                                <p>High - All data encrypted at rest and in transit with AES-256-GCM encryption</p>
                            </div>
                            <div class="kb-file-card">
                                <h4><i class="fas fa-file-contract"></i> Supported Formats</h4>
                                <p>PDF, DOC, TXT, CSV, HTML, Sitemap.xml, robots.txt, and web scraping capabilities</p>
                            </div>
                            <div class="kb-file-card">
                                <h4><i class="fas fa-sync-alt"></i> Last Updated</h4>
                                <p id="kbDetailLastUpdated">Just now</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Playground Detail Page -->
        <div id="chat-playground-page" class="tab-content" style="display: none;">
            <a href="#" class="back-btn" id="backToChatList">
                <i class="fas fa-arrow-left"></i> Back to Chat Playground
            </a>
            <div class="main-content">
                <div class="card">
                    <h2><i class="fas fa-comments"></i> <span id="chatSessionName">AI Chat Session</span></h2>
                    <div class="kb-selector">
                        <label for="chatSessionKb"><i class="fas fa-folder"></i> Knowledge Base</label>
                        <div class="custom-select" id="chatSessionKbSelect">
                            <div class="select-header">
                                <span>None (General Chat)</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option selected" data-value="">
                                    <i class="fas fa-comments"></i>
                                    <span>None (General Chat)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatSessionMessages">
                            <div class="message assistant">
                                Hello! I'm ready to assist you with your knowledge base.
                            </div>
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatSessionInput" placeholder="Type your message..." autocomplete="off">
                            <button id="chatSessionSendBtn"><i class="fas fa-paper-plane"></i> Send</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-cogs"></i> Session Configuration</h2>
                    <div class="form-group">
                        <label for="chatSessionProvider"><i class="fas fa-robot"></i> AI Provider</label>
                        <div class="custom-select" id="chatSessionProviderSelect">
                            <div class="select-header">
                                <span>OpenAI</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option selected" data-value="openai">
                                    <i class="fab fa-openai"></i>
                                    <span>OpenAI</span>
                                </div>
                                <div class="select-option" data-value="anthropic">
                                    <i class="fas fa-robot"></i>
                                    <span>Claude (Anthropic)</span>
                                </div>
                                <div class="select-option" data-value="gemini">
                                    <i class="fas fa-gem"></i>
                                    <span>Gemini (Google)</span>
                                </div>
                                <div class="select-option" data-value="mistral">
                                    <i class="fas fa-wind"></i>
                                    <span>Mistral AI</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="chatSessionModel"><i class="fas fa-microchip"></i> Model</label>
                        <div class="custom-select" id="chatSessionModelSelect">
                            <div class="select-header">
                                <span>GPT-4</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option selected" data-value="gpt-4">
                                    <i class="fas fa-brain"></i>
                                    <span>GPT-4</span>
                                </div>
                                <div class="select-option" data-value="gpt-3.5-turbo">
                                    <i class="fas fa-brain"></i>
                                    <span>GPT-3.5 Turbo</span>
                                </div>
                                <div class="select-option" data-value="claude-3-opus">
                                    <i class="fas fa-robot"></i>
                                    <span>Claude 3 Opus</span>
                                </div>
                                <div class="select-option" data-value="gemini-pro">
                                    <i class="fas fa-gem"></i>
                                    <span>Gemini Pro</span>
                                </div>
                                <div class="select-option" data-value="mistral-7b">
                                    <i class="fas fa-wind"></i>
                                    <span>Mistral 7B</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="chatSessionTemperature"><i class="fas fa-thermometer-half"></i> Temperature: <span id="chatSessionTempValue">0.7</span></label>
                        <input type="range" id="chatSessionTemperature" min="0" max="1" step="0.1" value="0.7" class="input-group">
                    </div>
                    <div class="form-group">
                        <label for="chatSessionMaxTokens"><i class="fas fa-text-height"></i> Max Tokens</label>
                        <div class="input-group">
                            <input type="number" id="chatSessionMaxTokens" min="100" max="4000" value="2000">
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="clearChatSessionBtn">
                        <i class="fas fa-trash"></i> Clear Chat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Security Constants
        const SECURITY_LEVELS = {
            HIGH: 'high',
            MEDIUM: 'medium',
            LOW: 'low'
        };

        // Mock storage for demonstration
        let storedKeys = JSON.parse(localStorage.getItem('aiKeysVault') || '[]');
        let knowledgeBases = JSON.parse(localStorage.getItem('knowledgeBases') || '[]');
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');

        // DOM Elements
        const mainDashboard = document.getElementById('main-dashboard');
        const kbDetailPage = document.getElementById('kb-detail-page');
        const chatPlaygroundPage = document.getElementById('chat-playground-page');
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const apiKeyForm = document.getElementById('apiKeyForm');
        const providerSelect = document.getElementById('providerSelect');
        const togglePassword = document.getElementById('togglePassword');
        const apiKeyInput = document.getElementById('apiKey');
        const submitBtn = document.getElementById('submitBtn');
        const keysList = document.getElementById('keysList');
        const notification = document.getElementById('notification');
        const kbForm = document.getElementById('kbForm');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const kbSubmitBtn = document.getElementById('kbSubmitBtn');
        const kbList = document.getElementById('kbList');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const clearChatBtn = document.getElementById('clearChatBtn');
        const temperature = document.getElementById('temperature');
        const tempValue = document.getElementById('tempValue');
        const backToKbList = document.getElementById('backToKbList');
        const backToChatList = document.getElementById('backToChatList');
        const kbDetailName = document.getElementById('kbDetailName');
        const kbDetailDate = document.getElementById('kbDetailDate');
        const kbDetailStats = document.getElementById('kbDetailStats');
        const kbDetailFiles = document.getElementById('kbDetailFiles');
        const kbDetailUrls = document.getElementById('kbDetailUrls');
        const kbDetailFavorite = document.getElementById('kbDetailFavorite');
        const kbDetailDelete = document.getElementById('kbDetailDelete');
        const kbDetailLastUpdated = document.getElementById('kbDetailLastUpdated');

        // Current selected knowledge base
        let currentKbId = null;

        // Provider icons mapping
        const providerIcons = {
            openai: 'fab fa-openai',
            anthropic: 'fas fa-robot',
            gemini: 'fas fa-gem',
            mistral: 'fas fa-wind',
            cohere: 'fas fa-cube',
            huggingface: 'fas fa-hat-wizard'
        };

        const providerNames = {
            openai: 'OpenAI',
            anthropic: 'Claude (Anthropic)',
            gemini: 'Gemini (Google)',
            mistral: 'Mistral AI',
            cohere: 'Cohere',
            huggingface: 'Hugging Face'
        };

        // Initialize tabs
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
                if (btn.dataset.tab === 'knowledge') {
                    updateKbStats();
                    populateChatKbDropdown();
                }
            });
        });

        // Back buttons
        backToKbList.addEventListener('click', (e) => {
            e.preventDefault();
            mainDashboard.style.display = 'block';
            kbDetailPage.style.display = 'none';
            document.querySelector('.tab-btn[data-tab="knowledge"]').click();
        });

        backToChatList.addEventListener('click', (e) => {
            e.preventDefault();
            mainDashboard.style.display = 'block';
            chatPlaygroundPage.style.display = 'none';
            document.querySelector('.tab-btn[data-tab="chat"]').click();
        });

        // Initialize provider selection
        let selectedProvider = null;
        const providerOptions = providerSelect.querySelectorAll('.provider-option');
        providerOptions.forEach(option => {
            option.addEventListener('click', () => {
                providerOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedProvider = option.dataset.provider;
            });
        });

        // Initialize file type selection
        let selectedFileTypes = new Set();
        const fileTypes = document.getElementById('fileTypes').querySelectorAll('.file-type-option');
        fileTypes.forEach(type => {
            type.addEventListener('click', () => {
                type.classList.toggle('selected');
                if (type.classList.contains('selected')) {
                    selectedFileTypes.add(type.dataset.type);
                } else {
                    selectedFileTypes.delete(type.dataset.type);
                }
            });
        });

        // File upload handling
        fileUploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                addFileToList(file);
            });
        });

        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = '#6366f1';
            fileUploadArea.style.transform = 'scale(1.02)';
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.style.borderColor = '#e5e7eb';
            fileUploadArea.style.transform = 'scale(1)';
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = '#e5e7eb';
            fileUploadArea.style.transform = 'scale(1)';
            const files = Array.from(e.dataTransfer.files);
            files.forEach(file => {
                addFileToList(file);
            });
        });

        function addFileToList(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-name">
                    <i class="fas fa-file"></i>
                    ${file.name}
                </div>
                <div class="file-size">${formatFileSize(file.size)}</div>
                <button class="remove-file" onclick="removeFile(this, '${file.name}')">
                    <i class="fas fa-times"></i> Remove
                </button>
            `;
            fileList.appendChild(fileItem);
        }

        function removeFile(button, fileName) {
            button.closest('.file-item').remove();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Toggle password visibility
        let passwordVisible = false;
        togglePassword.addEventListener('click', () => {
            passwordVisible = !passwordVisible;
            apiKeyInput.type = passwordVisible ? 'text' : 'password';
            togglePassword.innerHTML = passwordVisible ? 
                '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
        });

        // Show notification
        function showNotification(message, type = 'success') {
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Generate mock encrypted key
        function encryptKey(apiKey) {
            return btoa(apiKey + Date.now().toString());
        }

        // Store API key
        async function storeApiKey(userId, provider, apiKey) {
            try {
                submitBtn.innerHTML = '<span class="loading"></span> Storing...';
                submitBtn.disabled = true;
                
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const encryptedKey = encryptKey(apiKey);
                const newKey = {
                    id: Date.now().toString(),
                    userId,
                    provider,
                    encryptedKey,
                    createdAt: new Date().toISOString(),
                    providerName: providerNames[provider] || provider,
                    securityLevel: SECURITY_LEVELS.HIGH
                };
                
                storedKeys.push(newKey);
                localStorage.setItem('aiKeysVault', JSON.stringify(storedKeys));
                
                showNotification(`API key for ${providerNames[provider]} stored securely!`, 'success');
                renderKeysList();
                apiKeyForm.reset();
                providerOptions.forEach(opt => opt.classList.remove('selected'));
                selectedProvider = null;
                
            } catch (error) {
                showNotification('Failed to store API key. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Store Securely';
                submitBtn.disabled = false;
            }
        }

        // Delete API key
        function deleteKey(keyId) {
            if (confirm('Are you sure you want to delete this API key? This action cannot be undone.')) {
                storedKeys = storedKeys.filter(key => key.id !== keyId);
                localStorage.setItem('aiKeysVault', JSON.stringify(storedKeys));
                showNotification('API key deleted successfully!', 'success');
                renderKeysList();
            }
        }

        // Copy key to clipboard (mock)
        function copyKeyToClipboard(encryptedKey) {
            const maskedKey = '••••••••••••••••';
            navigator.clipboard.writeText(maskedKey).then(() => {
                showNotification('Masked key copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Failed to copy key.', 'error');
            });
        }

        // Render keys list
        function renderKeysList() {
            if (storedKeys.length === 0) {
                keysList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-lock"></i>
                        <h3>No API Keys Found</h3>
                        <p>Add your first API key to get started</p>
                    </div>
                `;
                return;
            }

            keysList.innerHTML = '';
            storedKeys.forEach(key => {
                const keyElement = document.createElement('div');
                keyElement.className = 'key-item';
                keyElement.innerHTML = `
                    <div class="key-info">
                        <h4>${key.providerName}</h4>
                        <p>User: ${key.userId} • Added: ${new Date(key.createdAt).toLocaleDateString()}</p>
                    </div>
                    <div class="key-actions">
                        <button class="copy-btn" onclick="copyKeyToClipboard('${key.encryptedKey}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="delete-btn" onclick="deleteKey('${key.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                keysList.appendChild(keyElement);
            });
        }

        // Create Knowledge Base
        async function createKnowledgeBase(name, files, urls, fileTypes) {
            try {
                kbSubmitBtn.innerHTML = '<span class="loading"></span> Creating...';
                kbSubmitBtn.disabled = true;
                
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                const newKb = {
                    id: Date.now().toString(),
                    name,
                    files: files || [],
                    urls: urls || [],
                    fileTypes: Array.from(fileTypes),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    favorited: false,
                    securityLevel: SECURITY_LEVELS.HIGH,
                    documentCount: (files?.length || 0) + (urls?.length || 0)
                };
                
                knowledgeBases.push(newKb);
                localStorage.setItem('knowledgeBases', JSON.stringify(knowledgeBases));
                
                showNotification(`Knowledge base "${name}" created successfully!`, 'success');
                renderKnowledgeBases();
                kbForm.reset();
                fileList.innerHTML = '';
                selectedFileTypes.clear();
                fileTypes.forEach(type => type.classList.remove('selected'));
                updateKbStats();
                populateChatKbDropdown();
                
            } catch (error) {
                showNotification('Failed to create knowledge base. Please try again.', 'error');
            } finally {
                kbSubmitBtn.innerHTML = '<i class="fas fa-plus"></i> Create Knowledge Base';
                kbSubmitBtn.disabled = false;
            }
        }

        // Delete Knowledge Base
        function deleteKnowledgeBase(kbId) {
            if (confirm('Are you sure you want to delete this knowledge base? All data will be permanently removed.')) {
                knowledgeBases = knowledgeBases.filter(kb => kb.id !== kbId);
                localStorage.setItem('knowledgeBases', JSON.stringify(knowledgeBases));
                showNotification('Knowledge base deleted successfully!', 'success');
                renderKnowledgeBases();
                updateKbStats();
                populateChatKbDropdown();
                // Go back to list if we're on detail page
                if (currentKbId === kbId) {
                    backToKbList.click();
                }
            }
        }

        // Toggle favorite
        function toggleFavorite(kbId) {
            const kb = knowledgeBases.find(k => k.id === kbId);
            if (kb) {
                kb.favorited = !kb.favorited;
                localStorage.setItem('knowledgeBases', JSON.stringify(knowledgeBases));
                renderKnowledgeBases();
                updateKbStats();
                // Update detail page if visible
                if (currentKbId === kbId) {
                    renderKbDetail(kb);
                }
            }
        }

        // Update KB stats
        function updateKbStats() {
            const totalKbs = knowledgeBases.length;
            const totalFiles = knowledgeBases.reduce((sum, kb) => sum + (kb.files?.length || 0), 0);
            const totalUrls = knowledgeBases.reduce((sum, kb) => sum + (kb.urls?.length || 0), 0);
            const favoritedKbs = knowledgeBases.filter(kb => kb.favorited).length;
            
            document.getElementById('totalKbs').textContent = totalKbs;
            document.getElementById('totalFiles').textContent = totalFiles;
            document.getElementById('totalUrls').textContent = totalUrls;
            document.getElementById('favoritedKbs').textContent = favoritedKbs;
        }

        // Advanced Custom Dropdown Implementation
        function initCustomSelect(selectId, options = []) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const header = select.querySelector('.select-header');
            const optionsContainer = select.querySelector('.select-options');
            const optionsList = select.querySelectorAll('.select-option');
            
            // Close all other dropdowns
            function closeOtherDropdowns(except = null) {
                document.querySelectorAll('.custom-select').forEach(sel => {
                    if (sel !== except) {
                        sel.querySelector('.select-header').classList.remove('active');
                        sel.querySelector('.select-options').classList.remove('show');
                    }
                });
            }
            
            // Toggle dropdown
            header.addEventListener('click', (e) => {
                e.stopPropagation();
                const isActive = header.classList.contains('active');
                closeOtherDropdowns(select);
                if (!isActive) {
                    header.classList.add('active');
                    optionsContainer.classList.add('show');
                } else {
                    header.classList.remove('active');
                    optionsContainer.classList.remove('show');
                }
            });
            
            // Select option
            optionsList.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Remove selected class from all options
                    optionsList.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    // Update header text
                    const selectedText = option.querySelector('span').textContent;
                    header.querySelector('span').textContent = selectedText;
                    // Close dropdown
                    header.classList.remove('active');
                    optionsContainer.classList.remove('show');
                    // Trigger change event if needed
                    if (selectId === 'sortSelect') {
                        document.getElementById('sortKb').value = option.dataset.value;
                        renderKnowledgeBases();
                    } else if (selectId === 'filterSelect') {
                        document.getElementById('filterKb').value = option.dataset.value;
                        renderKnowledgeBases();
                    }
                });
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                header.classList.remove('active');
                optionsContainer.classList.remove('show');
            });
        }

        // Populate chat KB dropdown
        function populateChatKbDropdown() {
            const chatKbSelect = document.getElementById('chatKbSelect');
            const optionsContainer = chatKbSelect.querySelector('.select-options');
            
            // Clear existing options except the first one
            while (optionsContainer.children.length > 1) {
                optionsContainer.removeChild(optionsContainer.lastChild);
            }
            
            knowledgeBases.forEach(kb => {
                const option = document.createElement('div');
                option.className = 'select-option';
                option.dataset.value = kb.id;
                option.innerHTML = `
                    <i class="fas fa-folder"></i>
                    <span>${kb.name}</span>
                `;
                optionsContainer.appendChild(option);
            });
            
            // Re-initialize the dropdown
            initCustomSelect('chatKbSelect');
        }

        // Render Knowledge Bases
        function renderKnowledgeBases() {
            if (knowledgeBases.length === 0) {
                kbList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>No Knowledge Bases Found</h3>
                        <p>Create your first knowledge base to get started</p>
                    </div>
                `;
                return;
            }

            // Apply filters and sorting
            let filteredKbs = [...knowledgeBases];
            
            // Search filter
            const searchTerm = document.getElementById('searchKb').value.toLowerCase();
            if (searchTerm) {
                filteredKbs = filteredKbs.filter(kb => 
                    kb.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Favorite filter
            const filterValue = document.getElementById('filterKb').value;
            if (filterValue === 'favorited') {
                filteredKbs = filteredKbs.filter(kb => kb.favorited);
            } else if (filterValue === 'recent') {
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                filteredKbs = filteredKbs.filter(kb => 
                    new Date(kb.createdAt) > sevenDaysAgo
                );
            }
            
            // Sorting
            const sortValue = document.getElementById('sortKb').value;
            filteredKbs.sort((a, b) => {
                switch (sortValue) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'files':
                        return (b.files?.length || 0) - (a.files?.length || 0);
                    default:
                        return 0;
                }
            });

            kbList.innerHTML = '';
            filteredKbs.forEach(kb => {
                const kbElement = document.createElement('div');
                kbElement.className = 'kb-item';
                kbElement.innerHTML = `
                    <div class="kb-info">
                        <h4>${kb.name}</h4>
                        <p>Files: ${kb.files?.length || 0} • URLs: ${kb.urls?.length || 0} • 
                           Created: ${new Date(kb.createdAt).toLocaleDateString()}</p>
                    </div>
                    <div class="kb-actions">
                        <button class="favorite-btn ${kb.favorited ? 'favorited' : ''}" 
                                onclick="toggleFavorite('${kb.id}')">
                            <i class="fas fa-star"></i> ${kb.favorited ? 'Favorited' : 'Favorite'}
                        </button>
                        <button class="delete-btn" onclick="deleteKnowledgeBase('${kb.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                kbElement.addEventListener('click', () => {
                    showKbDetail(kb.id);
                });
                kbList.appendChild(kbElement);
            });
        }

        // Show Knowledge Base Detail
        function showKbDetail(kbId) {
            const kb = knowledgeBases.find(k => k.id === kbId);
            if (kb) {
                currentKbId = kbId;
                renderKbDetail(kb);
                mainDashboard.style.display = 'none';
                kbDetailPage.style.display = 'block';
            }
        }

        // Render Knowledge Base Detail
        function renderKbDetail(kb) {
            kbDetailName.textContent = kb.name;
            kbDetailDate.textContent = new Date(kb.createdAt).toLocaleDateString();
            kbDetailStats.textContent = `${kb.files?.length || 0} files, ${kb.urls?.length || 0} URLs`;
            kbDetailLastUpdated.textContent = new Date(kb.updatedAt).toLocaleString();
            
            // Render files
            if (kb.files && kb.files.length > 0) {
                kbDetailFiles.innerHTML = '';
                kb.files.forEach(file => {
                    const fileCard = document.createElement('div');
                    fileCard.className = 'kb-file-card';
                    fileCard.innerHTML = `
                        <h4><i class="fas fa-file"></i> ${file.name}</h4>
                        <p>Size: ${formatFileSize(file.size)} • Type: ${file.type || 'Unknown'}</p>
                    `;
                    kbDetailFiles.appendChild(fileCard);
                });
            } else {
                kbDetailFiles.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No files uploaded</p>
                    </div>
                `;
            }
            
            // Render URLs
            if (kb.urls && kb.urls.length > 0) {
                kbDetailUrls.innerHTML = '';
                kb.urls.forEach(url => {
                    const urlCard = document.createElement('div');
                    urlCard.className = 'kb-url-card';
                    urlCard.innerHTML = `
                        <h4><i class="fas fa-link"></i> ${url}</h4>
                        <p>Type: Web Content • Status: Indexed</p>
                    `;
                    kbDetailUrls.appendChild(urlCard);
                });
            } else {
                kbDetailUrls.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-link"></i>
                        <p>No URLs added</p>
                    </div>
                `;
            }
            
            // Update favorite button
            kbDetailFavorite.innerHTML = kb.favorited ? 
                '<i class="fas fa-star"></i> Favorited' : '<i class="fas fa-star"></i> Favorite';
            kbDetailFavorite.className = kb.favorited ? 
                'btn btn-secondary favorited' : 'btn btn-secondary';
            
            // Add event listeners
            kbDetailFavorite.onclick = () => toggleFavorite(kb.id);
            kbDetailDelete.onclick = () => deleteKnowledgeBase(kb.id);
        }
		
		
		
		// Create Knowledge Base
async function createKnowledgeBase(name, files, urls, fileTypes) {
    try {
        kbSubmitBtn.innerHTML = '<span class="loading"></span> Creating...';
        kbSubmitBtn.disabled = true;
        await new Promise(resolve => setTimeout(resolve, 1200));

        const now = new Date().toISOString();
        const newKb = {
            id: Date.now().toString(),
            name: name.trim(),
            files: files || [],
            urls: urls || [],
            fileTypes: Array.from(fileTypes),
            createdAt: now,
            updatedAt: now,
            favorited: false,
            securityLevel: 'high',
            documentCount: (files?.length || 0) + (urls?.length || 0)
        };

        // Save to localStorage
        knowledgeBases.push(newKb);
        localStorage.setItem('knowledgeBases', JSON.stringify(knowledgeBases));

        showNotification(`Knowledge base "${name}" created successfully!`, 'success');
        renderKnowledgeBases();
        kbForm.reset();
        fileList.innerHTML = '';
        selectedFileTypes.clear();
        document.querySelectorAll('.file-type-option').forEach(el => el.classList.remove('selected'));
        updateKbStats();
        populateChatKbDropdown();
    } catch (error) {
        console.error('KB Save Error:', error);
        showNotification('Failed to create knowledge base. Please try again.', 'error');
    } finally {
        kbSubmitBtn.innerHTML = '<i class="fas fa-plus"></i> Create Knowledge Base';
        kbSubmitBtn.disabled = false;
    }
}


// Render Knowledge Bases with Sorting & Filtering
function renderKnowledgeBases() {
    if (knowledgeBases.length === 0) {
        kbList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <h3>No Knowledge Bases Found</h3>
                <p>Create your first knowledge base to get started</p>
            </div>
        `;
        return;
    }

    let filteredKbs = [...knowledgeBases];

    // 🔍 Search filter
    const searchTerm = document.getElementById('searchKb')?.value.toLowerCase() || '';
    if (searchTerm) {
        filteredKbs = filteredKbs.filter(kb => 
            kb.name.toLowerCase().includes(searchTerm)
        );
    }

    // ⭐ Favorite/Recent filter
    const filterValue = document.getElementById('filterKb')?.value || 'all';
    if (filterValue === 'favorited') {
        filteredKbs = filteredKbs.filter(kb => kb.favorited);
    } else if (filterValue === 'recent') {
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        filteredKbs = filteredKbs.filter(kb => 
            new Date(kb.createdAt) > sevenDaysAgo
        );
    }

    // 🔀 Sorting logic
    const sortValue = document.getElementById('sortKb')?.value || 'date';
    filteredKbs.sort((a, b) => {
        switch (sortValue) {
            case 'name': // Alphabetical A-Z
                return a.name.localeCompare(b.name);
            case 'date': // Latest First (newest on top)
                return new Date(b.createdAt) - new Date(a.createdAt);
            case 'updated': // Recently Updated First
                return new Date(b.updatedAt) - new Date(a.updatedAt);
            case 'files': // Most files first
                return (b.files?.length || 0) - (a.files?.length || 0);
            default:
                return 0;
        }
    });

    // 🖼️ Render list
    kbList.innerHTML = '';
    filteredKbs.forEach(kb => {
        const kbElement = document.createElement('div');
        kbElement.className = 'kb-item';
        kbElement.innerHTML = `
            <div class="kb-info">
                <h4>${kb.name}</h4>
                <p>Files: ${kb.files?.length || 0} • URLs: ${kb.urls?.length || 0} • 
                   Created: ${new Date(kb.createdAt).toLocaleDateString()}</p>
            </div>
            <div class="kb-actions">
                <button class="favorite-btn ${kb.favorited ? 'favorited' : ''}" 
                        onclick="toggleFavorite('${kb.id}')">
                    <i class="fas fa-star"></i> ${kb.favorited ? 'Favorited' : 'Favorite'}
                </button>
                <button class="delete-btn" onclick="deleteKnowledgeBase('${kb.id}')">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        `;
        kbElement.addEventListener('click', () => showKbDetail(kb.id));
        kbList.appendChild(kbElement);
    });
}
		
		
		
		

        // Chat functionality
        function addMessage(role, content, container = chatMessages) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.textContent = content;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        async function sendMessage(container = chatMessages, input = chatInput, button = sendBtn) {
            const message = input.value.trim();
            if (!message) return;
            
            addMessage('user', message, container);
            input.value = '';
            
            // Simulate AI response
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span>';
            
            setTimeout(() => {
                const responses = [
                    "I understand your query. Based on the knowledge base, here's what I found...",
                    "That's an interesting question! Let me analyze the available information.",
                    "I've processed your request and here are the relevant insights from the knowledge base.",
                    "Great question! The knowledge base contains several relevant pieces of information on this topic."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage('assistant', randomResponse, container);
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-paper-plane"></i> Send';
            }, 1500);
        }

        function clearChat(container = chatMessages) {
            container.innerHTML = '<div class="message assistant">Hello! I\'m your AI assistant. How can I help you today?</div>';
            chatHistory = [];
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        // Event Listeners
        apiKeyForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const userId = document.getElementById('userId').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!userId || !selectedProvider || !apiKey) {
                showNotification('Please fill in all fields and select a provider.', 'error');
                return;
            }
            
            if (apiKey.length < 20) {
                showNotification('API key appears to be invalid. Please check your key.', 'error');
                return;
            }
            
            storeApiKey(userId, selectedProvider, apiKey);
        });

        kbForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const kbName = document.getElementById('kbName').value.trim();
            const kbUrls = document.getElementById('kbUrls').value.trim();
            
            if (!kbName) {
                showNotification('Please enter a knowledge base name.', 'error');
                return;
            }
            
            if (selectedFileTypes.size === 0) {
                showNotification('Please select at least one file type.', 'error');
                return;
            }
            
            const files = Array.from(fileInput.files).map(file => ({
                name: file.name,
                size: file.size,
                type: file.type
            }));
            
            const urls = kbUrls ? kbUrls.split('\n').filter(url => url.trim()).map(url => url.trim()) : [];
            
            createKnowledgeBase(kbName, files, urls, selectedFileTypes);
        });

        sendBtn.addEventListener('click', () => sendMessage());
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        clearChatBtn.addEventListener('click', () => clearChat());

        temperature.addEventListener('input', () => {
            tempValue.textContent = temperature.value;
        });

        // Initialize custom dropdowns
        document.addEventListener('DOMContentLoaded', () => {
            initCustomSelect('sortSelect');
            initCustomSelect('filterSelect');
            initCustomSelect('chatKbSelect');
            initCustomSelect('chatProviderSelect');
            initCustomSelect('chatModelSelect');
            initCustomSelect('chatSessionKbSelect');
            initCustomSelect('chatSessionProviderSelect');
            initCustomSelect('chatSessionModelSelect');
        });

        // Initialize
        renderKeysList();
        renderKnowledgeBases();
        updateKbStats();

        // Expose functions to global scope
        window.copyKeyToClipboard = copyKeyToClipboard;
        window.deleteKey = deleteKey;
        window.toggleFavorite = toggleFavorite;
        window.deleteKnowledgeBase = deleteKnowledgeBase;
        window.removeFile = removeFile;
        window.showKbDetail = showKbDetail;

        // Add event listeners for filters
        document.getElementById('searchKb').addEventListener('input', renderKnowledgeBases);
        document.getElementById('filterKb').addEventListener('change', renderKnowledgeBases);
        document.getElementById('sortKb').addEventListener('change', renderKnowledgeBases);
		
		
		
		
    </script>
</body>
</html>