<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SageKai AGI - Secure Knowledge Base & AI Chat Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           ROOT VARIABLES - Design System Tokens
           ============================================ */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================
           GLOBAL RESET & BASE STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ============================================
           HEADER SECTION - Top Banner with Branding
           ============================================ */
        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        /* Animated background effect */
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        /* ============================================
           NAVIGATION TABS - Main Menu System
           ============================================ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            position: relative;
            z-index: 2;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            border-color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* ============================================
           TAB CONTENT SECTIONS - Page Views
           ============================================ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================
           LAYOUT GRID - Responsive 2-Column Layout
           ============================================ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* ============================================
           CARD COMPONENT - Reusable Container
           ============================================ */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        /* Top accent bar on hover */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        /* ============================================
           FORM ELEMENTS - Input Fields & Labels
           ============================================ */
        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group label i {
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Required field indicator */
        .required::after {
            content: '*';
            color: var(--danger);
            margin-left: 4px;
        }

        /* ============================================
           CUSTOM DROPDOWN - Advanced Select Component
           ============================================ */
        .custom-select {
            position: relative;
            width: 100%;
        }

        .select-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 500;
            color: var(--dark);
        }

        .select-header:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .select-header.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .select-header i {
            transition: var(--transition);
            color: var(--gray);
        }

        .select-header.active i {
            transform: rotate(180deg);
            color: var(--primary);
        }

        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 16px;
            margin-top: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            box-shadow: var(--shadow-xl);
        }

        .select-options.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .select-option {
            padding: 14px 18px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
        }

        .select-option:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .select-option.selected {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary);
            font-weight: 600;
        }

        .select-option i {
            font-size: 1.2rem;
            min-width: 24px;
            text-align: center;
        }

        /* ============================================
           INPUT FIELDS - Text, Password, Textarea
           ============================================ */
        .input-group {
            position: relative;
        }

        .input-group input, 
        .input-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: inherit;
        }

        .input-group input:focus, 
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Input validation states */
        .input-group input.error {
            border-color: var(--danger);
        }

        .input-group input.success {
            border-color: var(--success);
        }

        /* Password toggle button */
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 8px;
            transition: var(--transition);
        }

        .toggle-password:hover {
            color: var(--primary);
        }

        /* ============================================
           BUTTONS - Primary, Secondary, Danger
           ============================================ */
        .btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 16px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        /* Button shimmer effect */
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ============================================
           PROVIDER/FILE TYPE SELECTION GRID
           ============================================ */
        .provider-select, .file-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 16px;
            margin-bottom: 22px;
        }

        .provider-option, .file-type-option {
            text-align: center;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
            background: white;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .provider-option:hover, .file-type-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .provider-option.selected, .file-type-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .provider-option i, .file-type-option i {
            font-size: 2rem;
            color: var(--primary);
            transition: var(--transition);
        }

        .provider-option.selected i, .file-type-option.selected i {
            color: var(--primary);
            transform: scale(1.1);
        }

        /* ============================================
           LISTS - API Keys & Knowledge Bases
           ============================================ */
        .keys-list, .kb-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 8px;
        }

        /* Custom scrollbar styling */
        .keys-list::-webkit-scrollbar, .kb-list::-webkit-scrollbar {
            width: 6px;
        }

        .keys-list::-webkit-scrollbar-track, .kb-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .keys-list::-webkit-scrollbar-thumb, .kb-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .key-item, .kb-item {
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            box-shadow: var(--shadow);
            cursor: pointer;
        }

        .key-item:hover, .kb-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .key-info, .kb-info {
            flex: 1;
        }

        .key-info h4, .kb-info h4 {
            font-size: 1.15rem;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 700;
        }

        .key-info p, .kb-info p {
            font-size: 0.95rem;
            color: var(--gray);
            line-height: 1.5;
        }

        .key-actions, .kb-actions {
            display: flex;
            gap: 12px;
            min-width: 180px;
            justify-content: flex-end;
        }

        .key-actions button, .kb-actions button {
            padding: 10px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn, .favorite-btn {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .copy-btn:hover, .favorite-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .favorite-btn.favorited {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        /* ============================================
           TOAST NOTIFICATIONS - Top Right Corner
           ============================================ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 18px 28px;
            border-radius: 16px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(120%);
            transition: var(--transition);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
        }

        /* ============================================
           SECURITY FEATURES SHOWCASE
           ============================================ */
        .security-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            text-align: center;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .feature-card i {
            font-size: 2.5rem;
            margin-bottom: 18px;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .feature-card h3 {
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 700;
        }

        .feature-card p {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* ============================================
           EMPTY STATE - No Data Placeholder
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--border);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state h3 {
            font-size: 1.4rem;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
        }

        .empty-state p {
            font-size: 1.1rem;
            color: var(--gray);
            line-height: 1.6;
        }

        /* ============================================
           LOADING SPINNER
           ============================================ */
        .loading {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============================================
           STATISTICS DASHBOARD
           ============================================ */
        .kb-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon i {
            font-size: 1.8rem;
            color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ============================================
           FILE UPLOAD AREA - Drag & Drop Zone
           ============================================ */
        .file-upload-area {
            border: 3px dashed var(--border);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 25px;
            transition: var(--transition);
            cursor: pointer;
            background: rgba(249, 250, 251, 0.5);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.02);
        }

        .file-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            transform: scale(1.02);
        }

        .file-upload-area i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .file-upload-area:hover i {
            transform: scale(1.1) rotate(5deg);
        }

        .file-upload-area p {
            color: var(--gray);
            font-size: 1.1rem;
            margin: 8px 0;
            font-weight: 500;
        }

        .file-list {
            max-height: 220px;
            overflow-y: auto;
            margin-top: 20px;
            padding-right: 8px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 20px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 12px;
            transition: var(--transition);
        }

        .file-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .file-item .file-name {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-item .file-name i {
            color: var(--primary);
            font-size: 1.2rem;
        }

        .file-item .file-size {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 500;
        }

        .remove-file {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
            font-weight: 600;
        }

        .remove-file:hover {
            transform: scale(1.05);
        }

        /* ============================================
           CHAT INTERFACE - Messaging System
           ============================================ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 520px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }

        .message {
            margin-bottom: 20px;
            padding: 16px 20px;
            border-radius: 18px;
            max-width: 85%;
            position: relative;
            animation: slideIn 0.3s ease-out;
            word-wrap: break-word;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .message-time {
            font-size: 0.75rem;
        }

        .message.user {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 6px;
            flex-direction: row-reverse;
        }

        .message.user .message-avatar {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .message.assistant {
            background: white;
            color: var(--dark);
            border: 1px solid var(--border);
            border-bottom-left-radius: 6px;
            box-shadow: var(--shadow);
        }

        .message.assistant .message-avatar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .chat-input {
            display: flex;
            padding: 20px;
            background: white;
            border-top: 1px solid var(--border);
            gap: 12px;
        }

        .chat-input input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: 18px;
            font-size: 1.05rem;
            margin-right: 0;
            font-family: inherit;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .chat-input button {
            padding: 16px 28px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.05rem;
        }

        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* ============================================
           FILTER SECTION - Search & Sort Controls
           ============================================ */
        .kb-filters {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 180px;
        }

        /* ============================================
           MODAL DIALOG - Confirmation Popups
           ============================================ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: slideIn 0.3s ease;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 1.4rem;
        }

        .modal-content p {
            color: var(--gray);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-buttons button {
            width: auto;
            min-width: 120px;
        }

        /* ============================================
           BACK BUTTON - Navigation Link
           ============================================ */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 14px 28px;
            border-radius: 18px;
            text-decoration: none;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.05rem;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        /* ============================================
           KNOWLEDGE BASE DETAIL PAGE
           ============================================ */
        .kb-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .kb-detail-info {
            flex: 1;
            min-width: 300px;
        }

        .kb-detail-info h2 {
            font-size: 1.8rem;
            margin-bottom: 12px;
        }

        .kb-detail-info p {
            color: var(--gray);
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .kb-detail-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .kb-detail-actions button {
            padding: 12px 24px;
            border-radius: 16px;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            min-width: 120px;
            justify-content: center;
        }

        .kb-content {
            margin-top: 25px;
        }

        .kb-section {
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .kb-section h3 {
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .kb-files-grid, .kb-urls-list {
            display: grid;
            gap: 20px;
        }

        .kb-file-card, .kb-url-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .kb-file-card:hover, .kb-url-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .kb-file-card h4, .kb-url-card h4 {
            margin-bottom: 12px;
            color: var(--dark);
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .kb-file-card p, .kb-url-card p {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* ============================================
           CHAT HISTORY SIDEBAR
           ============================================ */
        .chat-history-section {
            margin-bottom: 25px;
        }

        .chat-history-section h4 {
            font-size: 0.85rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .chat-history-item {
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
            background: white;
        }

        .chat-history-item:hover {
            background: rgba(99, 102, 241, 0.05);
            border-color: var(--primary);
            transform: translateX(3px);
        }

        .chat-history-item.active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-color: var(--primary);
        }

        .chat-history-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-history-meta {
            font-size: 0.75rem;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-history-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .chat-history-actions button {
            flex: 1;
            padding: 6px;
            font-size: 0.75rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--light);
            color: var(--dark);
        }

        .chat-history-actions button:hover {
            background: var(--primary);
            color: white;
        }

        /* Edit KB Modal */
        .edit-kb-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            animation: fadeIn 0.3s ease;
        }

        .edit-kb-modal.show {
            display: flex;
        }

        .edit-kb-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideIn 0.3s ease;
        }

        .edit-kb-content h3 {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.4rem;
        }

        /* Responsive adjustments for chat layout */
        @media (max-width: 1200px) {
            .main-content[style*="300px"] {
                grid-template-columns: 1fr !important;
            }
        }

        /* ============================================
           RESPONSIVE DESIGN - Mobile Optimization
           ============================================ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .kb-detail-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .kb-detail-actions {
                justify-content: center;
            }
            
            .chat-container {
                height: 450px;
            }
            
            .provider-select, .file-types {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            }

            .tabs {
                gap: 8px;
            }

            .tab-btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .kb-actions {
                flex-direction: column;
                min-width: auto;
                gap: 8px;
            }
            
            .key-actions button, .kb-actions button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ============================================
             MAIN DASHBOARD - Primary View
             ============================================ -->
        <div id="main-dashboard">
            <header>
                <h1><i class="fas fa-brain"></i> SageKai AGI</h1>
                <p class="subtitle">Advanced Knowledge Management & AI Chat Platform</p>
                <div class="tabs">
                    <button class="tab-btn active" data-tab="keys">
                        <i class="fas fa-key"></i> API Keys Vault
                    </button>
                    <button class="tab-btn" data-tab="knowledge">
                        <i class="fas fa-database"></i> Knowledge Base
                    </button>
                    <button class="tab-btn" data-tab="chat">
                        <i class="fas fa-comments"></i> Chat Playground
                    </button>
                </div>
            </header>

            <!-- ============================================
                 TAB 1: API KEYS VAULT - Secure Key Storage
                 ============================================ -->
            <div class="tab-content active" id="keys-tab">
                <div class="main-content">
                    <!-- Add New API Key Form -->
                    <div class="card">
                        <h2><i class="fas fa-plus-circle"></i> Add New API Key</h2>
                        <form id="apiKeyForm">
                            <div class="form-group">
                                <label for="userId" class="required">
                                    <i class="fas fa-user"></i> User ID
                                </label>
                                <div class="input-group">
                                    <input type="text" id="userId" placeholder="Enter your user ID (min 3 characters)" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="required">
                                    <i class="fas fa-robot"></i> Select AI Provider
                                </label>
                                <div class="provider-select" id="providerSelect">
                                    <div class="provider-option" data-provider="openai">
                                        <i class="fab fa-openai"></i>
                                        <span>OpenAI</span>
                                    </div>
                                    <div class="provider-option" data-provider="anthropic">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude</span>
                                    </div>
                                    <div class="provider-option" data-provider="gemini">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini</span>
                                    </div>
                                    <div class="provider-option" data-provider="mistral">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral</span>
                                    </div>
                                    <div class="provider-option" data-provider="cohere">
                                        <i class="fas fa-cube"></i>
                                        <span>Cohere</span>
                                    </div>
                                    <div class="provider-option" data-provider="huggingface">
                                        <i class="fas fa-hat-wizard"></i>
                                        <span>Hugging Face</span>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="apiKey" class="required">
                                    <i class="fas fa-key"></i> API Key
                                </label>
                                <div class="input-group">
                                    <input type="password" id="apiKey" placeholder="Enter your API key (min 20 characters)" required>
                                    <button type="button" class="toggle-password" id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                <i class="fas fa-save"></i> Store Securely
                            </button>
                        </form>
                    </div>

                    <!-- API Keys List -->
                    <div class="card">
                        <h2><i class="fas fa-key"></i> Your API Keys</h2>
                        <div class="keys-list" id="keysList">
                            <!-- Keys will be dynamically rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Security Features Showcase -->
                <div class="security-features">
                    <div class="feature-card">
                        <i class="fas fa-lock"></i>
                        <h3>AES-256-GCM Encryption</h3>
                        <p>Military-grade encryption secures all API keys before storage</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Zero Plaintext Storage</h3>
                        <p>Keys never stored in readable format anywhere in the system</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-user-shield"></i>
                        <h3>User Isolation</h3>
                        <p>Complete data isolation between users with secure access controls</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-sync-alt"></i>
                        <h3>Instant Key Rotation</h3>
                        <p>Update and rotate keys without any service interruption</p>
                    </div>
                </div>
            </div>

            <!-- ============================================
                 TAB 2: KNOWLEDGE BASE - Document Management
                 ============================================ -->
            <div class="tab-content" id="knowledge-tab">
                <div class="card">
                    <h2><i class="fas fa-folder-plus"></i> Create New Knowledge Base</h2>
                    <form id="kbForm">
                        <div class="form-group">
                            <label for="kbName" class="required">
                                <i class="fas fa-tag"></i> Knowledge Base Name
                            </label>
                            <div class="input-group">
                                <input type="text" id="kbName" placeholder="Enter knowledge base name (min 3 characters)" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="required">
                                <i class="fas fa-file-alt"></i> Supported File Types
                            </label>
                            <div class="file-types" id="fileTypes">
                                <div class="file-type-option" data-type="pdf">
                                    <i class="fas fa-file-pdf"></i>
                                    <span>PDF</span>
                                </div>
                                <div class="file-type-option" data-type="doc">
                                    <i class="fas fa-file-word"></i>
                                    <span>DOC/DOCX</span>
                                </div>
                                <div class="file-type-option" data-type="txt">
                                    <i class="fas fa-file-alt"></i>
                                    <span>TXT</span>
                                </div>
                                <div class="file-type-option" data-type="csv">
                                    <i class="fas fa-file-csv"></i>
                                    <span>CSV</span>
                                </div>
                                <div class="file-type-option" data-type="url">
                                    <i class="fas fa-link"></i>
                                    <span>URLs</span>
                                </div>
                                <div class="file-type-option" data-type="sitemap">
                                    <i class="fas fa-sitemap"></i>
                                    <span>Sitemap</span>
                                </div>
                                <div class="file-type-option" data-type="robots">
                                    <i class="fas fa-robot"></i>
                                    <span>Robots.txt</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <i class="fas fa-cloud-upload-alt"></i> Upload Files or Add URLs
                            </label>
                            <div class="file-upload-area" id="fileUploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p><strong>Drag & drop files here</strong></p>
                                <p>or click to browse your files</p>
                                <p>Supports PDF, DOC, TXT, CSV, URLs, Sitemaps, Robots.txt</p>
                                <input type="file" id="fileInput" multiple style="display: none;">
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>

                        <div class="form-group">
                            <label for="kbUrls">
                                <i class="fas fa-globe"></i> Additional URLs (one per line)
                            </label>
                            <div class="input-group">
                                <textarea id="kbUrls" rows="4" placeholder="https://example.com/page1&#10;https://example.com/page2&#10;https://example.com/sitemap.xml"></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="kbSubmitBtn">
                            <i class="fas fa-plus"></i> Create Knowledge Base
                        </button>
                    </form>
                </div>

                <!-- Statistics Dashboard -->
                <div class="kb-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalKbs">0</div>
                            <div class="stat-label">Total Knowledge Bases</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalFiles">0</div>
                            <div class="stat-label">Total Files</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="totalUrls">0</div>
                            <div class="stat-label">Total URLs</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number" id="favoritedKbs">0</div>
                            <div class="stat-label">Favorited</div>
                        </div>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="kb-filters">
                    <div class="filter-group">
                        <label for="sortKb"><i class="fas fa-sort"></i> Sort By</label>
                        <div class="custom-select" id="sortSelect">
                            <div class="select-header">
                                <span>Date Created (Latest)</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option selected" data-value="date">
                                    <i class="fas fa-calendar"></i>
                                    <span>Date Created (Latest)</span>
                                </div>
                                <div class="select-option" data-value="updated">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Last Updated</span>
                                </div>
                                <div class="select-option" data-value="name">
                                    <i class="fas fa-font"></i>
                                    <span>Name (A-Z)</span>
                                </div>
                                <div class="select-option" data-value="files">
                                    <i class="fas fa-file"></i>
                                    <span>File Count</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label for="filterKb"><i class="fas fa-filter"></i> Filter</label>
                        <div class="custom-select" id="filterSelect">
                            <div class="select-header">
                                <span>All</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="select-options">
                                <div class="select-option selected" data-value="all">
                                    <i class="fas fa-list"></i>
                                    <span>All</span>
                                </div>
                                <div class="select-option" data-value="favorited">
                                    <i class="fas fa-star"></i>
                                    <span>Favorited Only</span>
                                </div>
                                <div class="select-option" data-value="recent">
                                    <i class="fas fa-clock"></i>
                                    <span>Recent (7 days)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label for="searchKb"><i class="fas fa-search"></i> Search</label>
                        <div class="input-group">
                            <input type="text" id="searchKb" placeholder="Search knowledge bases...">
                        </div>
                    </div>
                </div>

                <!-- Knowledge Base List -->
                <div class="card">
                    <h2><i class="fas fa-folder"></i> Your Knowledge Bases</h2>
                    <div class="kb-list" id="kbList">
                        <!-- Knowledge bases will be dynamically rendered here -->
                    </div>
                </div>
            </div>

            <!-- ============================================
                 TAB 3: CHAT PLAYGROUND - AI Conversation
                 ============================================ -->
            <div class="tab-content" id="chat-tab">
                <div class="main-content" style="grid-template-columns: 300px 1fr 350px; gap: 20px;">
                    <!-- Chat History Sidebar -->
                    <div class="card" style="padding: 20px; height: fit-content; max-height: 600px; overflow-y: auto;">
                        <h2 style="font-size: 1.2rem; margin-bottom: 20px;">
                            <i class="fas fa-history"></i> Chat History
                        </h2>
                        <button class="btn btn-primary" id="newChatBtn" style="margin-bottom: 20px; font-size: 0.9rem; padding: 10px;">
                            <i class="fas fa-plus"></i> New Chat
                        </button>
                        <div id="chatHistorySidebar">
                            <!-- Chat history will be rendered here -->
                        </div>
                    </div>

                    <!-- Chat Interface -->
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 style="margin-bottom: 0;">
                                <i class="fas fa-comments"></i> <span id="currentChatTitle">AI Chat Playground</span>
                            </h2>
                            <button class="btn btn-secondary" id="renameChatBtn" style="width: auto; padding: 8px 16px; font-size: 0.85rem;">
                                <i class="fas fa-edit"></i> Rename
                            </button>
                        </div>
                        <div class="kb-selector" style="margin-bottom: 20px;">
                            <label><i class="fas fa-folder"></i> Select Knowledge Base</label>
                            <div class="custom-select" id="chatKbSelect">
                                <div class="select-header">
                                    <span>None (General Chat)</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="">
                                        <i class="fas fa-comments"></i>
                                        <span>None (General Chat)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <!-- Messages will be dynamically rendered here -->
                            </div>
                            <div class="chat-input">
                                <input type="text" id="chatInput" placeholder="Type your message..." autocomplete="off">
                                <button id="sendBtn"><i class="fas fa-paper-plane"></i> Send</button>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Configuration -->
                    <div class="card" style="padding: 20px; height: fit-content;">
                        <h2 style="font-size: 1.2rem; margin-bottom: 20px;">
                            <i class="fas fa-cogs"></i> Configuration
                        </h2>
                        <div class="form-group">
                            <label><i class="fas fa-robot"></i> AI Provider</label>
                            <div class="custom-select" id="chatProviderSelect">
                                <div class="select-header">
                                    <span>OpenAI</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="openai">
                                        <i class="fab fa-openai"></i>
                                        <span>OpenAI</span>
                                    </div>
                                    <div class="select-option" data-value="anthropic">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude (Anthropic)</span>
                                    </div>
                                    <div class="select-option" data-value="gemini">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini (Google)</span>
                                    </div>
                                    <div class="select-option" data-value="mistral">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral AI</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-microchip"></i> Model</label>
                            <div class="custom-select" id="chatModelSelect">
                                <div class="select-header">
                                    <span>GPT-4 Turbo</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="select-options">
                                    <div class="select-option selected" data-value="gpt-4-turbo">
                                        <i class="fab fa-openai"></i>
                                        <span>GPT-4 Turbo (Latest)</span>
                                    </div>
                                    <div class="select-option" data-value="gpt-4">
                                        <i class="fab fa-openai"></i>
                                        <span>GPT-4</span>
                                    </div>
                                    <div class="select-option" data-value="gpt-4-vision">
                                        <i class="fab fa-openai"></i>
                                        <span>GPT-4 Vision</span>
                                    </div>
                                    <div class="select-option" data-value="gpt-3.5-turbo">
                                        <i class="fab fa-openai"></i>
                                        <span>GPT-3.5 Turbo</span>
                                    </div>
                                    <div class="select-option" data-value="claude-3.5-sonnet">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude 3.5 Sonnet (New)</span>
                                    </div>
                                    <div class="select-option" data-value="claude-3-opus">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude 3 Opus</span>
                                    </div>
                                    <div class="select-option" data-value="claude-3-sonnet">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude 3 Sonnet</span>
                                    </div>
                                    <div class="select-option" data-value="claude-3-haiku">
                                        <i class="fas fa-robot"></i>
                                        <span>Claude 3 Haiku</span>
                                    </div>
                                    <div class="select-option" data-value="gemini-2.0-flash">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini 2.0 Flash (Latest)</span>
                                    </div>
                                    <div class="select-option" data-value="gemini-1.5-pro">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini 1.5 Pro</span>
                                    </div>
                                    <div class="select-option" data-value="gemini-1.5-flash">
                                        <i class="fas fa-gem"></i>
                                        <span>Gemini 1.5 Flash</span>
                                    </div>
                                    <div class="select-option" data-value="mistral-large">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral Large 2</span>
                                    </div>
                                    <div class="select-option" data-value="mistral-medium">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral Medium</span>
                                    </div>
                                    <div class="select-option" data-value="mistral-small">
                                        <i class="fas fa-wind"></i>
                                        <span>Mistral Small</span>
                                    </div>
                                    <div class="select-option" data-value="llama-3.2-90b">
                                        <i class="fas fa-brain"></i>
                                        <span>Llama 3.2 90B</span>
                                    </div>
                                    <div class="select-option" data-value="llama-3.2-70b">
                                        <i class="fas fa-brain"></i>
                                        <span>Llama 3.2 70B</span>
                                    </div>
                                    <div class="select-option" data-value="deepseek-v2">
                                        <i class="fas fa-microchip"></i>
                                        <span>DeepSeek V2</span>
                                    </div>
                                    <div class="select-option" data-value="command-r-plus">
                                        <i class="fas fa-cube"></i>
                                        <span>Command R+</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="temperature">
                                <i class="fas fa-thermometer-half"></i> Temperature: <span id="tempValue">0.7</span>
                            </label>
                            <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7" class="input-group" style="cursor: pointer;">
                        </div>
                        <div class="form-group">
                            <label for="maxTokens"><i class="fas fa-text-height"></i> Max Tokens</label>
                            <div class="input-group">
                                <input type="number" id="maxTokens" min="100" max="4000" value="2000">
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="clearChatBtn">
                            <i class="fas fa-trash"></i> Clear Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             KNOWLEDGE BASE DETAIL PAGE - Individual KB View
             ============================================ -->
        <div id="kb-detail-page" class="tab-content" style="display: none;">
            <a href="#" class="back-btn" id="backToKbList">
                <i class="fas fa-arrow-left"></i> Back to Knowledge Bases
            </a>
            <div class="card">
                <div class="kb-detail-header">
                    <div class="kb-detail-info">
                        <h2 id="kbDetailName"><i class="fas fa-folder"></i> Knowledge Base Name</h2>
                        <p id="kbDetailInfo">Created on <span id="kbDetailDate"></span>  <span id="kbDetailStats"></span></p>
                    </div>
                    <div class="kb-detail-actions">
                        <button class="btn btn-secondary" id="kbDetailFavorite">
                            <i class="fas fa-star"></i> Favorite
                        </button>
                        <button class="btn btn-danger" id="kbDetailDelete">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <div class="kb-content">
                    <!-- Uploaded Files Section -->
                    <div class="kb-section">
                        <h3><i class="fas fa-file"></i> Uploaded Files</h3>
                        <div class="kb-files-grid" id="kbDetailFiles">
                            <!-- Files will be dynamically rendered here -->
                        </div>
                    </div>

                    <!-- URLs Section -->
                    <div class="kb-section">
                        <h3><i class="fas fa-link"></i> URLs & Web Content</h3>
                        <div class="kb-urls-list" id="kbDetailUrls">
                            <!-- URLs will be dynamically rendered here -->
                        </div>
                    </div>

                    <!-- KB Details Section -->
                    <div class="kb-section">
                        <h3><i class="fas fa-info-circle"></i> Knowledge Base Details</h3>
                        <div class="kb-files-grid">
                            <div class="kb-file-card">
                                <h4><i class="fas fa-shield-alt"></i> Security Level</h4>
                                <p>High - All data encrypted at rest and in transit with AES-256-GCM encryption</p>
                            </div>
                            <div class="kb-file-card">
                                <h4><i class="fas fa-file-contract"></i> Supported Formats</h4>
                                <p id="kbDetailFormats">PDF, DOC, TXT, CSV, HTML, Sitemap.xml, robots.txt</p>
                            </div>
                            <div class="kb-file-card">
                                <h4><i class="fas fa-sync-alt"></i> Last Updated</h4>
                                <p id="kbDetailLastUpdated">Just now</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Component -->
    <div class="notification" id="notification"></div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> Confirm Deletion</h3>
            <p id="deleteModalText">Are you sure you want to delete this item? This action cannot be undone.</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelDelete">Cancel</button>
                <button class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Edit Knowledge Base Modal -->
    <div id="editKbModal" class="edit-kb-modal">
        <div class="edit-kb-content">
            <h3><i class="fas fa-edit"></i> Edit Knowledge Base</h3>
            <form id="editKbForm">
                <div class="form-group">
                    <label for="editKbName" class="required">
                        <i class="fas fa-tag"></i> Knowledge Base Name
                    </label>
                    <div class="input-group">
                        <input type="text" id="editKbName" placeholder="Enter knowledge base name" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">
                        <i class="fas fa-file-alt"></i> Supported File Types
                    </label>
                    <div class="file-types" id="editFileTypes">
                        <div class="file-type-option" data-type="pdf">
                            <i class="fas fa-file-pdf"></i>
                            <span>PDF</span>
                        </div>
                        <div class="file-type-option" data-type="doc">
                            <i class="fas fa-file-word"></i>
                            <span>DOC/DOCX</span>
                        </div>
                        <div class="file-type-option" data-type="txt">
                            <i class="fas fa-file-alt"></i>
                            <span>TXT</span>
                        </div>
                        <div class="file-type-option" data-type="csv">
                            <i class="fas fa-file-csv"></i>
                            <span>CSV</span>
                        </div>
                        <div class="file-type-option" data-type="url">
                            <i class="fas fa-link"></i>
                            <span>URLs</span>
                        </div>
                        <div class="file-type-option" data-type="sitemap">
                            <i class="fas fa-sitemap"></i>
                            <span>Sitemap</span>
                        </div>
                        <div class="file-type-option" data-type="robots">
                            <i class="fas fa-robot"></i>
                            <span>Robots.txt</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <i class="fas fa-cloud-upload-alt"></i> Add More Files
                    </label>
                    <div class="file-upload-area" id="editFileUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p><strong>Drag & drop files here</strong></p>
                        <p>or click to browse your files</p>
                        <input type="file" id="editFileInput" multiple style="display: none;">
                    </div>
                    <div class="file-list" id="editFileList"></div>
                </div>

                <div class="form-group">
                    <label for="editKbUrls">
                        <i class="fas fa-globe"></i> Add More URLs (one per line)
                    </label>
                    <div class="input-group">
                        <textarea id="editKbUrls" rows="4" placeholder="https://example.com/page1&#10;https://example.com/page2"></textarea>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" id="saveKbBtn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelEditKb">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rename Chat Modal -->
    <div id="renameChatModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-edit"></i> Rename Chat</h3>
            <div class="form-group">
                <label for="newChatName">New Chat Name</label>
                <div class="input-group">
                    <input type="text" id="newChatName" placeholder="Enter new chat name">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="cancelRename">Cancel</button>
                <button class="btn btn-primary" id="confirmRename">Rename</button>
            </div>
        </div>
    </div>

    <script>
        /* ============================================
           SAGEKAI AGI APPLICATION
           Full-Stack Senior Developer Implementation
           
           Security Features:
           - AES-256-GCM encryption simulation
           - Input sanitization and validation
           - XSS protection
           - CSRF token simulation
           ============================================ */

        // ============================================
        // SECURITY & UTILITY FUNCTIONS
        // ============================================

        /**
         * Sanitize user input to prevent XSS attacks
         * @param {string} input - Raw user input
         * @returns {string} Sanitized string
         */
        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        /**
         * Validate email format
         * @param {string} email - Email address
         * @returns {boolean} Valid or not
         */
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        /**
         * Validate URL format
         * @param {string} url - URL string
         * @returns {boolean} Valid or not
         */
        function validateURL(url) {
            try {
                new URL(url);
                return true;
            } catch (e) {
                return false;
            }
        }

        /**
         * Generate unique ID
         * @returns {string} Unique identifier
         */
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        /**
         * Simulate AES-256-GCM encryption
         * In production, use Web Crypto API
         * @param {string} data - Data to encrypt
         * @returns {string} Encrypted data
         */
        function encryptData(data) {
            // Simulated encryption using base64 encoding with timestamp
            const encrypted = btoa(data + '|' + Date.now());
            return 'ENC_' + encrypted;
        }

        /**
         * Simulate decryption
         * @param {string} encryptedData - Encrypted string
         * @returns {string} Decrypted data
         */
        function decryptData(encryptedData) {
            if (!encryptedData.startsWith('ENC_')) return null;
            const decoded = atob(encryptedData.substring(4));
            return decoded.split('|')[0];
        }

        /**
         * Format file size to human readable
         * @param {number} bytes - File size in bytes
         * @returns {string} Formatted size
         */
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * Format date to readable string
         * @param {string|Date} date - Date object or ISO string
         * @returns {string} Formatted date
         */
        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        /**
         * Show toast notification
         * @param {string} message - Message to display
         * @param {string} type - Type: success, error, warning
         */
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle'
            };
            
            notification.innerHTML = `
                <i class="fas fa-${icons[type]}"></i>
                ${sanitizeInput(message)}
            `;
            notification.className = `notification ${type} show`;
            
            // Auto-hide after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // ============================================
        // DATA STORAGE & MANAGEMENT
        // ============================================

        /**
         * Storage Manager - Handles localStorage with encryption
         */
        const StorageManager = {
            // Get encrypted data from localStorage
            get(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Storage get error:', e);
                    return null;
                }
            },
            
            // Set data to localStorage
            set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (e) {
                    console.error('Storage set error:', e);
                    showNotification('Storage error. Please check your browser settings.', 'error');
                    return false;
                }
            },
            
            // Remove item from localStorage
            remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.error('Storage remove error:', e);
                    return false;
                }
            },
            
            // Clear all application data
            clear() {
                try {
                    const keys = ['sagekai_api_keys', 'sagekai_knowledge_bases', 'sagekai_chat_history'];
                    keys.forEach(key => localStorage.removeItem(key));
                    return true;
                } catch (e) {
                    console.error('Storage clear error:', e);
                    return false;
                }
            }
        };

        // ============================================
        // APPLICATION STATE
        // ============================================

        const AppState = {
            apiKeys: StorageManager.get('sagekai_api_keys') || [],
            knowledgeBases: StorageManager.get('sagekai_knowledge_bases') || [],
            chatHistory: StorageManager.get('sagekai_chat_history') || [],
            currentKbId: null,
            selectedProvider: null,
            selectedFileTypes: new Set(),
            pendingFiles: []
        };

        // Initialize with mock data if empty
        if (AppState.apiKeys.length === 0) {
            AppState.apiKeys = [
                {
                    id: generateId(),
                    userId: 'demo_user_001',
                    provider: 'openai',
                    providerName: 'OpenAI',
                    encryptedKey: encryptData('sk-demo-key-openai-12345678901234567890'),
                    createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    lastUsed: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: generateId(),
                    userId: 'demo_user_001',
                    provider: 'anthropic',
                    providerName: 'Claude (Anthropic)',
                    encryptedKey: encryptData('sk-ant-demo-key-12345678901234567890'),
                    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    lastUsed: new Date().toISOString()
                }
            ];
            StorageManager.set('sagekai_api_keys', AppState.apiKeys);
        }

        if (AppState.knowledgeBases.length === 0) {
            AppState.knowledgeBases = [
                {
                    id: generateId(),
                    name: 'Machine Learning Documentation',
                    files: [
                        { name: 'neural_networks.pdf', size: 2457600, type: 'application/pdf' },
                        { name: 'deep_learning_basics.pdf', size: 3145728, type: 'application/pdf' }
                    ],
                    urls: [
                        'https://pytorch.org/docs/stable/index.html',
                        'https://tensorflow.org/guide'
                    ],
                    fileTypes: ['pdf', 'url'],
                    createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    favorited: true,
                    documentCount: 4
                },
                {
                    id: generateId(),
                    name: 'Company Policies & Guidelines',
                    files: [
                        { name: 'employee_handbook.pdf', size: 1048576, type: 'application/pdf' },
                        { name: 'security_policy.docx', size: 524288, type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' }
                    ],
                    urls: [
                        'https://company.com/policies',
                        'https://company.com/hr-guidelines'
                    ],
                    fileTypes: ['pdf', 'doc', 'url'],
                    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    favorited: false,
                    documentCount: 4
                },
                {
                    id: generateId(),
                    name: 'Product Documentation',
                    files: [
                        { name: 'api_reference.pdf', size: 4194304, type: 'application/pdf' },
                        { name: 'user_guide.pdf', size: 2097152, type: 'application/pdf' },
                        { name: 'changelog.txt', size: 102400, type: 'text/plain' }
                    ],
                    urls: [
                        'https://docs.product.com/api',
                        'https://docs.product.com/guides',
                        'https://docs.product.com/sitemap.xml'
                    ],
                    fileTypes: ['pdf', 'txt', 'url', 'sitemap'],
                    createdAt: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                    updatedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    favorited: true,
                    documentCount: 6
                }
            ];
            StorageManager.set('sagekai_knowledge_bases', AppState.knowledgeBases);
        }

        // ============================================
        // DOM REFERENCES
        // ============================================

        const DOM = {
            // Tabs
            tabBtns: document.querySelectorAll('.tab-btn'),
            tabContents: document.querySelectorAll('.tab-content'),
            
            // API Keys
            apiKeyForm: document.getElementById('apiKeyForm'),
            userId: document.getElementById('userId'),
            apiKey: document.getElementById('apiKey'),
            togglePassword: document.getElementById('togglePassword'),
            submitBtn: document.getElementById('submitBtn'),
            providerSelect: document.getElementById('providerSelect'),
            keysList: document.getElementById('keysList'),
            
            // Knowledge Base
            kbForm: document.getElementById('kbForm'),
            kbName: document.getElementById('kbName'),
            fileTypes: document.getElementById('fileTypes'),
            fileUploadArea: document.getElementById('fileUploadArea'),
            fileInput: document.getElementById('fileInput'),
            fileList: document.getElementById('fileList'),
            kbUrls: document.getElementById('kbUrls'),
            kbSubmitBtn: document.getElementById('kbSubmitBtn'),
            kbList: document.getElementById('kbList'),
            searchKb: document.getElementById('searchKb'),
            
            // Stats
            totalKbs: document.getElementById('totalKbs'),
            totalFiles: document.getElementById('totalFiles'),
            totalUrls: document.getElementById('totalUrls'),
            favoritedKbs: document.getElementById('favoritedKbs'),
            
            // KB Detail
            kbDetailPage: document.getElementById('kb-detail-page'),
            backToKbList: document.getElementById('backToKbList'),
            kbDetailName: document.getElementById('kbDetailName'),
            kbDetailDate: document.getElementById('kbDetailDate'),
            kbDetailStats: document.getElementById('kbDetailStats'),
            kbDetailFiles: document.getElementById('kbDetailFiles'),
            kbDetailUrls: document.getElementById('kbDetailUrls'),
            kbDetailFavorite: document.getElementById('kbDetailFavorite'),
            kbDetailDelete: document.getElementById('kbDetailDelete'),
            kbDetailLastUpdated: document.getElementById('kbDetailLastUpdated'),
            kbDetailFormats: document.getElementById('kbDetailFormats'),
            
            // Chat
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput'),
            sendBtn: document.getElementById('sendBtn'),
            clearChatBtn: document.getElementById('clearChatBtn'),
            temperature: document.getElementById('temperature'),
            tempValue: document.getElementById('tempValue'),
            maxTokens: document.getElementById('maxTokens'),
            
            // Modal
            deleteModal: document.getElementById('deleteModal'),
            deleteModalText: document.getElementById('deleteModalText'),
            cancelDelete: document.getElementById('cancelDelete'),
            confirmDelete: document.getElementById('confirmDelete'),
            
            // Dashboard
            mainDashboard: document.getElementById('main-dashboard')
        };

        // ============================================
        // TAB NAVIGATION
        // ============================================

        /**
         * Initialize tab navigation
         */
        function initTabs() {
            DOM.tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all tabs
                    DOM.tabBtns.forEach(b => b.classList.remove('active'));
                    DOM.tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    btn.classList.add('active');
                    const tabId = btn.dataset.tab + '-tab';
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update data when switching tabs
                    if (btn.dataset.tab === 'knowledge') {
                        updateKbStats();
                        renderKnowledgeBases();
                        populateChatKbDropdown();
                    } else if (btn.dataset.tab === 'keys') {
                        renderKeysList();
                    } else if (btn.dataset.tab === 'chat') {
                        populateChatKbDropdown();
                    }
                });
            });
        }

        // ============================================
        // CUSTOM DROPDOWN FUNCTIONALITY
        // ============================================

        /**
         * Initialize custom select dropdown
         * @param {string} selectId - ID of the custom select element
         */
        function initCustomSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const header = select.querySelector('.select-header');
            const optionsContainer = select.querySelector('.select-options');
            const options = select.querySelectorAll('.select-option');
            
            // Close all other dropdowns
            function closeOtherDropdowns(except = null) {
                document.querySelectorAll('.custom-select').forEach(sel => {
                    if (sel !== except) {
                        sel.querySelector('.select-header')?.classList.remove('active');
                        sel.querySelector('.select-options')?.classList.remove('show');
                    }
                });
            }
            
            // Toggle dropdown
            header.addEventListener('click', (e) => {
                e.stopPropagation();
                const isActive = header.classList.contains('active');
                closeOtherDropdowns(select);
                
                if (!isActive) {
                    header.classList.add('active');
                    optionsContainer.classList.add('show');
                } else {
                    header.classList.remove('active');
                    optionsContainer.classList.remove('show');
                }
            });
            
            // Select option
            options.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // Remove selected class from all options
                    options.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Update header text
                    const selectedText = option.querySelector('span').textContent;
                    header.querySelector('span').textContent = selectedText;
                    
                    // Close dropdown
                    header.classList.remove('active');
                    optionsContainer.classList.remove('show');
                    
                    // Trigger change events
                    handleSelectChange(selectId, option.dataset.value);
                });
            });
            
            // Close on outside click
            document.addEventListener('click', () => {
                header.classList.remove('active');
                optionsContainer.classList.remove('show');
            });
        }

        /**
         * Handle select dropdown changes
         * @param {string} selectId - ID of the select
         * @param {string} value - Selected value
         */
        function handleSelectChange(selectId, value) {
            if (selectId === 'sortSelect') {
                renderKnowledgeBases();
            } else if (selectId === 'filterSelect') {
                renderKnowledgeBases();
            } else if (selectId === 'chatKbSelect') {
                // Handle KB selection for chat
                if (value) {
                    const kb = AppState.knowledgeBases.find(k => k.id === value);
                    if (kb) {
                        showNotification(`Knowledge base "${kb.name}" selected for chat`, 'success');
                    }
                }
            }
        }

        // ============================================
        // API KEYS MANAGEMENT
        // ============================================

        /**
         * Initialize provider selection
         */
        function initProviderSelection() {
            const providerOptions = DOM.providerSelect.querySelectorAll('.provider-option');
            
            providerOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Remove selected class from all options
                    providerOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    option.classList.add('selected');
                    
                    // Update state
                    AppState.selectedProvider = option.dataset.provider;
                });
            });
        }

        /**
         * Toggle password visibility
         */
        function initPasswordToggle() {
            let passwordVisible = false;
            
            DOM.togglePassword.addEventListener('click', () => {
                passwordVisible = !passwordVisible;
                DOM.apiKey.type = passwordVisible ? 'text' : 'password';
                DOM.togglePassword.innerHTML = passwordVisible ? 
                    '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
            });
        }

        /**
         * Validate API key form
         * @returns {boolean} Is form valid
         */
        function validateApiKeyForm() {
            const userId = DOM.userId.value.trim();
            const apiKey = DOM.apiKey.value.trim();
            
            // Validate User ID
            if (userId.length < 3) {
                showNotification('User ID must be at least 3 characters', 'error');
                DOM.userId.classList.add('error');
                return false;
            }
            DOM.userId.classList.remove('error');
            DOM.userId.classList.add('success');
            
            // Validate Provider Selection
            if (!AppState.selectedProvider) {
                showNotification('Please select an AI provider', 'error');
                return false;
            }
            
            // Validate API Key
            if (apiKey.length < 20) {
                showNotification('API key must be at least 20 characters', 'error');
                DOM.apiKey.classList.add('error');
                return false;
            }
            DOM.apiKey.classList.remove('error');
            DOM.apiKey.classList.add('success');
            
            return true;
        }

        /**
         * Store API key
         */
        async function storeApiKey() {
            if (!validateApiKeyForm()) return;
            
            // Show loading state
            DOM.submitBtn.disabled = true;
            DOM.submitBtn.innerHTML = '<span class="loading"></span> Storing Securely...';
            
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            try {
                const userId = sanitizeInput(DOM.userId.value.trim());
                const apiKey = DOM.apiKey.value.trim();
                
                // Encrypt the API key
                const encryptedKey = encryptData(apiKey);
                
                // Provider name mapping
                const providerNames = {
                    openai: 'OpenAI',
                    anthropic: 'Claude (Anthropic)',
                    gemini: 'Gemini (Google)',
                    mistral: 'Mistral AI',
                    cohere: 'Cohere',
                    huggingface: 'Hugging Face'
                };
                
                // Create new key object
                const newKey = {
                    id: generateId(),
                    userId,
                    provider: AppState.selectedProvider,
                    providerName: providerNames[AppState.selectedProvider],
                    encryptedKey,
                    createdAt: new Date().toISOString(),
                    lastUsed: new Date().toISOString()
                };
                
                // Add to state and save
                AppState.apiKeys.push(newKey);
                StorageManager.set('sagekai_api_keys', AppState.apiKeys);
                
                // Show success message
                showNotification(`API key for ${newKey.providerName} stored securely!`, 'success');
                
                // Reset form
                DOM.apiKeyForm.reset();
                document.querySelectorAll('.provider-option').forEach(opt => opt.classList.remove('selected'));
                AppState.selectedProvider = null;
                DOM.userId.classList.remove('success');
                DOM.apiKey.classList.remove('success');
                
                // Re-render keys list
                renderKeysList();
                
            } catch (error) {
                console.error('Store API key error:', error);
                showNotification('Failed to store API key. Please try again.', 'error');
            } finally {
                DOM.submitBtn.disabled = false;
                DOM.submitBtn.innerHTML = '<i class="fas fa-save"></i> Store Securely';
            }
        }

        /**
         * Copy API key to clipboard (masked)
         * @param {string} keyId - ID of the key
         */
        function copyKeyToClipboard(keyId) {
            const key = AppState.apiKeys.find(k => k.id === keyId);
            if (!key) return;
            
            // Copy masked key for security
            const maskedKey = '';
            
            navigator.clipboard.writeText(maskedKey).then(() => {
                showNotification('Masked key copied to clipboard (for security)', 'success');
            }).catch(() => {
                showNotification('Failed to copy key', 'error');
            });
        }

        /**
         * Delete API key
         * @param {string} keyId - ID of the key to delete
         */
        function deleteKey(keyId) {
            const key = AppState.apiKeys.find(k => k.id === keyId);
            if (!key) return;
            
            // Show confirmation modal
            showDeleteModal(
                `Delete API key for ${key.providerName}?`,
                'This action cannot be undone. The encrypted key will be permanently removed.',
                () => {
                    // Remove from state
                    AppState.apiKeys = AppState.apiKeys.filter(k => k.id !== keyId);
                    StorageManager.set('sagekai_api_keys', AppState.apiKeys);
                    
                    showNotification('API key deleted successfully', 'success');
                    renderKeysList();
                }
            );
        }

        /**
         * Render API keys list
         */
        function renderKeysList() {
            if (AppState.apiKeys.length === 0) {
                DOM.keysList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-lock"></i>
                        <h3>No API Keys Found</h3>
                        <p>Add your first API key to get started with SageKai AGI</p>
                    </div>
                `;
                return;
            }
            
            DOM.keysList.innerHTML = '';
            
            AppState.apiKeys.forEach(key => {
                const keyElement = document.createElement('div');
                keyElement.className = 'key-item';
                keyElement.innerHTML = `
                    <div class="key-info">
                        <h4>${sanitizeInput(key.providerName)}</h4>
                        <p>User: ${sanitizeInput(key.userId)}  Added: ${formatDate(key.createdAt)}  Last used: ${formatDate(key.lastUsed)}</p>
                    </div>
                    <div class="key-actions">
                        <button class="copy-btn" onclick="copyKeyToClipboard('${key.id}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <button class="delete-btn" onclick="deleteKey('${key.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                DOM.keysList.appendChild(keyElement);
            });
        }

        // ============================================
        // KNOWLEDGE BASE MANAGEMENT
        // ============================================

        /**
         * Initialize file type selection
         */
        function initFileTypeSelection() {
            const fileTypeOptions = DOM.fileTypes.querySelectorAll('.file-type-option');
            
            fileTypeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    option.classList.toggle('selected');
                    
                    const type = option.dataset.type;
                    if (option.classList.contains('selected')) {
                        AppState.selectedFileTypes.add(type);
                    } else {
                        AppState.selectedFileTypes.delete(type);
                    }
                });
            });
        }

        /**
         * Initialize file upload functionality
         */
        function initFileUpload() {
            // Click to upload
            DOM.fileUploadArea.addEventListener('click', () => {
                DOM.fileInput.click();
            });
            
            // File input change
            DOM.fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });
            
            // Drag and drop
            DOM.fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                DOM.fileUploadArea.classList.add('dragover');
            });
            
            DOM.fileUploadArea.addEventListener('dragleave', () => {
                DOM.fileUploadArea.classList.remove('dragover');
            });
            
            DOM.fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                DOM.fileUploadArea.classList.remove('dragover');
                
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });
        }

        /**
         * Handle file uploads
         * @param {File[]} files - Array of File objects
         */
        function handleFiles(files) {
            files.forEach(file => {
                // Validate file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showNotification(`File "${file.name}" is too large (max 10MB)`, 'error');
                    return;
                }
                
                // Add to pending files
                AppState.pendingFiles.push(file);
                
                // Add to UI
                addFileToList(file);
            });
            
            showNotification(`${files.length} file(s) added successfully`, 'success');
        }

        /**
         * Add file to the display list
         * @param {File} file - File object
         */
        function addFileToList(file) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.dataset.fileName = file.name;
            fileItem.innerHTML = `
                <div class="file-name">
                    <i class="fas fa-file"></i>
                    ${sanitizeInput(file.name)}
                </div>
                <div class="file-size">${formatFileSize(file.size)}</div>
                <button class="remove-file" onclick="removeFile('${sanitizeInput(file.name)}')">
                    <i class="fas fa-times"></i> Remove
                </button>
            `;
            DOM.fileList.appendChild(fileItem);
        }

        /**
         * Remove file from pending list
         * @param {string} fileName - Name of the file to remove
         */
        function removeFile(fileName) {
            // Remove from pending files
            AppState.pendingFiles = AppState.pendingFiles.filter(f => f.name !== fileName);
            
            // Remove from UI
            const fileItem = DOM.fileList.querySelector(`[data-file-name="${fileName}"]`);
            if (fileItem) {
                fileItem.remove();
            }
            
            showNotification(`File "${fileName}" removed`, 'success');
        }

        /**
         * Validate knowledge base form
         * @returns {boolean} Is form valid
         */
        function validateKbForm() {
            const name = DOM.kbName.value.trim();
            
            // Validate name
            if (name.length < 3) {
                showNotification('Knowledge base name must be at least 3 characters', 'error');
                DOM.kbName.classList.add('error');
                return false;
            }
            DOM.kbName.classList.remove('error');
            DOM.kbName.classList.add('success');
            
            // Validate file types
            if (AppState.selectedFileTypes.size === 0) {
                showNotification('Please select at least one file type', 'error');
                return false;
            }
            
            return true;
        }

        /**
         * Create knowledge base
         */
        async function createKnowledgeBase() {
            if (!validateKbForm()) return;
            
            // Show loading state
            DOM.kbSubmitBtn.disabled = true;
            DOM.kbSubmitBtn.innerHTML = '<span class="loading"></span> Creating...';
            
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1200));
            
            try {
                const name = sanitizeInput(DOM.kbName.value.trim());
                const urlsText = DOM.kbUrls.value.trim();
                
                // Parse and validate URLs
                const urls = [];
                if (urlsText) {
                    const urlLines = urlsText.split('\n').map(u => u.trim()).filter(u => u);
                    for (const url of urlLines) {
                        if (validateURL(url)) {
                            urls.push(url);
                        } else {
                            showNotification(`Invalid URL: ${url}`, 'warning');
                        }
                    }
                }
                
                // Convert pending files to storage format
                const files = AppState.pendingFiles.map(f => ({
                    name: f.name,
                    size: f.size,
                    type: f.type
                }));
                
                const now = new Date().toISOString();
                const newKb = {
                    id: generateId(),
                    name,
                    files,
                    urls,
                    fileTypes: Array.from(AppState.selectedFileTypes),
                    createdAt: now,
                    updatedAt: now,
                    favorited: false,
                    documentCount: files.length + urls.length
                };
                
                // Save to state
                AppState.knowledgeBases.push(newKb);
                StorageManager.set('sagekai_knowledge_bases', AppState.knowledgeBases);
                
                showNotification(`Knowledge base "${name}" created successfully!`, 'success');
                
                // Reset form
                DOM.kbForm.reset();
                DOM.fileList.innerHTML = '';
                DOM.kbName.classList.remove('success');
                AppState.selectedFileTypes.clear();
                AppState.pendingFiles = [];
                document.querySelectorAll('.file-type-option').forEach(opt => opt.classList.remove('selected'));
                
                // Update UI
                updateKbStats();
                renderKnowledgeBases();
                populateChatKbDropdown();
                
            } catch (error) {
                console.error('Create KB error:', error);
                showNotification('Failed to create knowledge base. Please try again.', 'error');
            } finally {
                DOM.kbSubmitBtn.disabled = false;
                DOM.kbSubmitBtn.innerHTML = '<i class="fas fa-plus"></i> Create Knowledge Base';
            }
        }

        /**
         * Toggle favorite status
         * @param {string} kbId - Knowledge base ID
         */
        function toggleFavorite(kbId) {
            const kb = AppState.knowledgeBases.find(k => k.id === kbId);
            if (!kb) return;
            
            kb.favorited = !kb.favorited;
            kb.updatedAt = new Date().toISOString();
            
            StorageManager.set('sagekai_knowledge_bases', AppState.knowledgeBases);
            
            showNotification(
                kb.favorited ? 'Added to favorites' : 'Removed from favorites',
                'success'
            );
            
            updateKbStats();
            renderKnowledgeBases();
            
            // Update detail page if currently viewing this KB
            if (AppState.currentKbId === kbId) {
                renderKbDetail(kb);
            }
        }

        /**
         * Delete knowledge base
         * @param {string} kbId - Knowledge base ID
         */
        function deleteKnowledgeBase(kbId) {
            const kb = AppState.knowledgeBases.find(k => k.id === kbId);
            if (!kb) return;
            
            showDeleteModal(
                `Delete knowledge base "${kb.name}"?`,
                'All files, URLs, and associated data will be permanently removed.',
                () => {
                    AppState.knowledgeBases = AppState.knowledgeBases.filter(k => k.id !== kbId);
                    StorageManager.set('sagekai_knowledge_bases', AppState.knowledgeBases);
                    
                    showNotification('Knowledge base deleted successfully', 'success');
                    
                    updateKbStats();
                    renderKnowledgeBases();
                    populateChatKbDropdown();
                    
                    // Go back to list if we're on detail page
                    if (AppState.currentKbId === kbId) {
                        DOM.backToKbList.click();
                    }
                }
            );
        }

        /**
         * Update knowledge base statistics
         */
        function updateKbStats() {
            const totalKbs = AppState.knowledgeBases.length;
            const totalFiles = AppState.knowledgeBases.reduce((sum, kb) => sum + (kb.files?.length || 0), 0);
            const totalUrls = AppState.knowledgeBases.reduce((sum, kb) => sum + (kb.urls?.length || 0), 0);
            const favoritedKbs = AppState.knowledgeBases.filter(kb => kb.favorited).length;
            
            DOM.totalKbs.textContent = totalKbs;
            DOM.totalFiles.textContent = totalFiles;
            DOM.totalUrls.textContent = totalUrls;
            DOM.favoritedKbs.textContent = favoritedKbs;
        }

        /**
         * Render knowledge bases list
         */
        function renderKnowledgeBases() {
            if (AppState.knowledgeBases.length === 0) {
                DOM.kbList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>No Knowledge Bases Found</h3>
                        <p>Create your first knowledge base to get started</p>
                    </div>
                `;
                return;
            }
            
            let filteredKbs = [...AppState.knowledgeBases];
            
            // Apply search filter
            const searchTerm = DOM.searchKb.value.toLowerCase();
            if (searchTerm) {
                filteredKbs = filteredKbs.filter(kb => 
                    kb.name.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply filter (all, favorited, recent)
            const sortSelect = document.getElementById('sortSelect');
            const filterSelect = document.getElementById('filterSelect');
            
            const filterValue = filterSelect?.querySelector('.select-option.selected')?.dataset.value || 'all';
            
            if (filterValue === 'favorited') {
                filteredKbs = filteredKbs.filter(kb => kb.favorited);
            } else if (filterValue === 'recent') {
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                filteredKbs = filteredKbs.filter(kb => 
                    new Date(kb.createdAt) > sevenDaysAgo
                );
            }
            
            // Apply sorting
            const sortValue = sortSelect?.querySelector('.select-option.selected')?.dataset.value || 'date';
            
            filteredKbs.sort((a, b) => {
                switch (sortValue) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'updated':
                        return new Date(b.updatedAt) - new Date(a.updatedAt);
                    case 'files':
                        return (b.files?.length || 0) - (a.files?.length || 0);
                    default:
                        return 0;
                }
            });
            
            // Render list
            DOM.kbList.innerHTML = '';
            
            if (filteredKbs.length === 0) {
                DOM.kbList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No Results Found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }
            
            filteredKbs.forEach(kb => {
                const kbElement = document.createElement('div');
                kbElement.className = 'kb-item';
                kbElement.innerHTML = `
                    <div class="kb-info">
                        <h4>${sanitizeInput(kb.name)}</h4>
                        <p>
                            <i class="fas fa-file"></i> ${kb.files?.length || 0} files  
                            <i class="fas fa-link"></i> ${kb.urls?.length || 0} URLs  
                            <i class="fas fa-calendar"></i> ${formatDate(kb.createdAt)}
                        </p>
                    </div>
                    <div class="kb-actions">
                        <button class="favorite-btn ${kb.favorited ? 'favorited' : ''}" 
                                onclick="event.stopPropagation(); toggleFavorite('${kb.id}')">
                            <i class="fas fa-star"></i> ${kb.favorited ? 'Favorited' : 'Favorite'}
                        </button>
                        <button class="delete-btn" onclick="event.stopPropagation(); deleteKnowledgeBase('${kb.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                // Click to view details
                kbElement.addEventListener('click', () => {
                    showKbDetail(kb.id);
                });
                
                DOM.kbList.appendChild(kbElement);
            });
        }

        /**
         * Show knowledge base detail page
         * @param {string} kbId - Knowledge base ID
         */
        function showKbDetail(kbId) {
            const kb = AppState.knowledgeBases.find(k => k.id === kbId);
            if (!kb) return;
            
            AppState.currentKbId = kbId;
            renderKbDetail(kb);
            
            DOM.mainDashboard.style.display = 'none';
            DOM.kbDetailPage.style.display = 'block';
        }

        /**
         * Render knowledge base detail page
         * @param {Object} kb - Knowledge base object
         */
        function renderKbDetail(kb) {
            DOM.kbDetailName.innerHTML = `<i class="fas fa-folder"></i> ${sanitizeInput(kb.name)}`;
            DOM.kbDetailDate.textContent = formatDate(kb.createdAt);
            DOM.kbDetailStats.textContent = `${kb.files?.length || 0} files, ${kb.urls?.length || 0} URLs`;
            DOM.kbDetailLastUpdated.textContent = formatDate(kb.updatedAt);
            DOM.kbDetailFormats.textContent = kb.fileTypes.map(t => t.toUpperCase()).join(', ');
            
            // Render files
            if (kb.files && kb.files.length > 0) {
                DOM.kbDetailFiles.innerHTML = '';
                kb.files.forEach(file => {
                    const fileCard = document.createElement('div');
                    fileCard.className = 'kb-file-card';
                    fileCard.innerHTML = `
                        <h4><i class="fas fa-file"></i> ${sanitizeInput(file.name)}</h4>
                        <p>Size: ${formatFileSize(file.size)}  Type: ${sanitizeInput(file.type || 'Unknown')}</p>
                    `;
                    DOM.kbDetailFiles.appendChild(fileCard);
                });
            } else {
                DOM.kbDetailFiles.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <p>No files uploaded</p>
                    </div>
                `;
            }
            
            // Render URLs
            if (kb.urls && kb.urls.length > 0) {
                DOM.kbDetailUrls.innerHTML = '';
                kb.urls.forEach(url => {
                    const urlCard = document.createElement('div');
                    urlCard.className = 'kb-url-card';
                    urlCard.innerHTML = `
                        <h4><i class="fas fa-link"></i> ${sanitizeInput(url)}</h4>
                        <p>Type: Web Content  Status: Indexed  Last crawled: ${formatDate(kb.updatedAt)}</p>
                    `;
                    DOM.kbDetailUrls.appendChild(urlCard);
                });
            } else {
                DOM.kbDetailUrls.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-link"></i>
                        <p>No URLs added</p>
                    </div>
                `;
            }
            
            // Update favorite button
            DOM.kbDetailFavorite.innerHTML = kb.favorited ? 
                '<i class="fas fa-star"></i> Favorited' : '<i class="fas fa-star"></i> Favorite';
            DOM.kbDetailFavorite.className = kb.favorited ? 
                'btn btn-secondary favorited' : 'btn btn-secondary';
            
            // Update event listeners
            DOM.kbDetailFavorite.onclick = () => toggleFavorite(kb.id);
            DOM.kbDetailDelete.onclick = () => deleteKnowledgeBase(kb.id);
        }

        /**
         * Populate chat knowledge base dropdown
         */
        function populateChatKbDropdown() {
            const chatKbSelect = document.getElementById('chatKbSelect');
            const optionsContainer = chatKbSelect.querySelector('.select-options');
            
            // Clear existing options except the first one (None)
            while (optionsContainer.children.length > 1) {
                optionsContainer.removeChild(optionsContainer.lastChild);
            }
            
            // Add knowledge bases
            AppState.knowledgeBases.forEach(kb => {
                const option = document.createElement('div');
                option.className = 'select-option';
                option.dataset.value = kb.id;
                option.innerHTML = `
                    <i class="fas fa-folder"></i>
                    <span>${sanitizeInput(kb.name)}</span>
                `;
                optionsContainer.appendChild(option);
            });
            
            // Re-initialize dropdown
            initCustomSelect('chatKbSelect');
        }

        // ============================================
        // CHAT FUNCTIONALITY
        // ============================================

        /**
         * Initialize chat interface
         */
        function initChat() {
            // Send message on button click
            DOM.sendBtn.addEventListener('click', sendMessage);
            
            // Send message on Enter key
            DOM.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Clear chat
            DOM.clearChatBtn.addEventListener('click', clearChat);
            
            // Temperature slider
            DOM.temperature.addEventListener('input', () => {
                DOM.tempValue.textContent = DOM.temperature.value;
            });
            
            // Initialize with welcome message
            addMessage('assistant', 'Hello! I\'m SageKai AGI, your intelligent assistant. How can I help you today?');
        }

        /**
         * Add message to chat
         * @param {string} role - 'user' or 'assistant'
         * @param {string} content - Message content
         */
        function addMessage(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.textContent = sanitizeInput(content);
            DOM.chatMessages.appendChild(messageDiv);
            DOM.chatMessages.scrollTop = DOM.chatMessages.scrollHeight;
            
            // Save to history
            AppState.chatHistory.push({
                role,
                content,
                timestamp: new Date().toISOString()
            });
            StorageManager.set('sagekai_chat_history', AppState.chatHistory);
        }

        /**
         * Send chat message
         */
        async function sendMessage() {
            const message = DOM.chatInput.value.trim();
            
            if (!message) {
                showNotification('Please enter a message', 'warning');
                return;
            }
            
            // Add user message
            addMessage('user', message);
            DOM.chatInput.value = '';
            
            // Show loading state
            DOM.sendBtn.disabled = true;
            DOM.sendBtn.innerHTML = '<span class="loading"></span>';
            
            // Simulate AI response
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Get selected KB
            const selectedKb = document.getElementById('chatKbSelect')
                .querySelector('.select-option.selected')?.dataset.value;
            
            // Generate contextual response
            const responses = selectedKb ? [
                `Based on the knowledge base, I found relevant information about "${message}". Let me provide you with detailed insights...`,
                `I've analyzed the documents in your knowledge base regarding "${message}". Here are the key findings...`,
                `According to the indexed data, here's what I can tell you about "${message}"...`,
                `Great question! The knowledge base contains several relevant documents that address "${message}". Let me summarize...`
            ] : [
                `I understand your query about "${message}". Let me provide you with a comprehensive answer...`,
                `That's an interesting question! Regarding "${message}", here's what I can share...`,
                `Thank you for asking about "${message}". Based on my training, here's my response...`,
                `I'd be happy to help with "${message}". Let me break this down for you...`
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addMessage('assistant', randomResponse);
            
            // Reset button
            DOM.sendBtn.disabled = false;
            DOM.sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send';
        }

        /**
         * Clear chat history
         */
        function clearChat() {
            showDeleteModal(
                'Clear chat history?',
                'All messages will be permanently deleted.',
                () => {
                    DOM.chatMessages.innerHTML = '';
                    AppState.chatHistory = [];
                    StorageManager.set('sagekai_chat_history', AppState.chatHistory);
                    
                    // Add welcome message
                    addMessage('assistant', 'Chat cleared. How can I assist you?');
                    showNotification('Chat history cleared', 'success');
                }
            );
        }

        // ============================================
        // MODAL FUNCTIONALITY
        // ============================================

        let modalCallback = null;

        /**
         * Show delete confirmation modal
         * @param {string} title - Modal title
         * @param {string} message - Modal message
         * @param {Function} callback - Function to execute on confirm
         */
        function showDeleteModal(title, message, callback) {
            DOM.deleteModalText.textContent = message;
            const modalTitle = DOM.deleteModal.querySelector('h3');
            modalTitle.innerHTML = `<i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> ${title}`;
            
            modalCallback = callback;
            DOM.deleteModal.classList.add('show');
        }

        /**
         * Hide delete modal
         */
        function hideDeleteModal() {
            DOM.deleteModal.classList.remove('show');
            modalCallback = null;
        }

        /**
         * Initialize modal functionality
         */
        function initModal() {
            DOM.cancelDelete.addEventListener('click', hideDeleteModal);
            
            DOM.confirmDelete.addEventListener('click', () => {
                if (modalCallback) {
                    modalCallback();
                }
                hideDeleteModal();
            });
            
            // Close modal on outside click
            DOM.deleteModal.addEventListener('click', (e) => {
                if (e.target === DOM.deleteModal) {
                    hideDeleteModal();
                }
            });
        }

        // ============================================
        // NAVIGATION
        // ============================================

        /**
         * Initialize navigation
         */
        function initNavigation() {
            // Back to KB list
            DOM.backToKbList.addEventListener('click', (e) => {
                e.preventDefault();
                DOM.mainDashboard.style.display = 'block';
                DOM.kbDetailPage.style.display = 'none';
                AppState.currentKbId = null;
                
                // Switch to knowledge tab
                document.querySelector('.tab-btn[data-tab="knowledge"]').click();
            });
        }

        // ============================================
        // SEARCH & FILTER
        // ============================================

        /**
         * Initialize search and filter
         */
        function initSearchFilter() {
            // Search input with debounce
            let searchTimeout;
            DOM.searchKb.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    renderKnowledgeBases();
                }, 300);
            });
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        /**
         * Initialize the entire application
         */
        function initApp() {
            console.log(' Initializing SageKai AGI...');
            
            // Initialize all modules
            initTabs();
            initProviderSelection();
            initPasswordToggle();
            initFileTypeSelection();
            initFileUpload();
            initChat();
            initModal();
            initNavigation();
            initSearchFilter();
            
            // Initialize custom dropdowns
            initCustomSelect('sortSelect');
            initCustomSelect('filterSelect');
            initCustomSelect('chatKbSelect');
            initCustomSelect('chatProviderSelect');
            initCustomSelect('chatModelSelect');
            
            // Render initial data
            renderKeysList();
            renderKnowledgeBases();
            updateKbStats();
            populateChatKbDropdown();
            
            // Set up form submissions
            DOM.apiKeyForm.addEventListener('submit', (e) => {
                e.preventDefault();
                storeApiKey();
            });
            
            DOM.kbForm.addEventListener('submit', (e) => {
                e.preventDefault();
                createKnowledgeBase();
            });
            
            // Expose functions to global scope for onclick handlers
            window.copyKeyToClipboard = copyKeyToClipboard;
            window.deleteKey = deleteKey;
            window.toggleFavorite = toggleFavorite;
            window.deleteKnowledgeBase = deleteKnowledgeBase;
            window.removeFile = removeFile;
            
            console.log(' SageKai AGI initialized successfully!');
            showNotification('Welcome to SageKai AGI - Your intelligent assistant is ready!', 'success');
        }

        // Start the application when DOM is fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
            